<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPS DevOps Agent - Professional Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>

/* ===== AI ASSISTANT STYLES - Extracted from ai-assistant-panel.html ===== */
#ai-assistant-panel{position:fixed;bottom:20px;right:20px;width:400px;max-height:600px;background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:9999;display:flex;flex-direction:column;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;border:1px solid rgba(102,126,234,.3)}#ai-assistant-panel.minimized{max-height:60px}#ai-assistant-panel.hidden{transform:translateX(500px);opacity:0;pointer-events:none}.ai-panel-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none}.ai-panel-title{display:flex;align-items:center;gap:10px;color:#fff;font-weight:600;font-size:16px}.ai-panel-icon{font-size:20px;animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.ai-panel-controls{display:flex;gap:8px}.ai-panel-btn{width:32px;height:32px;border-radius:8px;background:rgba(255,255,255,.1);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.ai-panel-btn:hover{background:rgba(255,255,255,.2);transform:scale(1.05)}.ai-server-context{padding:8px 16px;background:rgba(16,185,129,.1);border-bottom:1px solid rgba(16,185,129,.2);display:flex;align-items:center;gap:8px;font-size:12px;color:#10b981}.ai-server-context.no-server{background:rgba(245,158,11,.1);border-bottom-color:rgba(245,158,11,.2);color:#f59e0b}.server-indicator{width:8px;height:8px;background:#10b981;border-radius:50%;animation:blink 2s infinite}.server-indicator.disconnected{background:#f59e0b}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}.ai-chat-container{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;min-height:300px;max-height:400px}.ai-chat-container::-webkit-scrollbar{width:6px}.ai-chat-container::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:10px}.ai-chat-container::-webkit-scrollbar-thumb{background:rgba(102,126,234,.5);border-radius:10px}.ai-message{padding:12px 16px;border-radius:12px;max-width:85%;word-wrap:break-word;animation:slideIn .3s ease}@keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.ai-message.user{align-self:flex-end;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;margin-left:auto}.ai-message.assistant{align-self:flex-start;background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(102,126,234,.3)}.ai-message.system{align-self:center;background:rgba(59,130,246,.1);color:#3b82f6;font-size:12px;border:1px solid rgba(59,130,246,.3);text-align:center;max-width:100%}.ai-message-header{display:flex;align-items:center;gap:6px;margin-bottom:6px;font-size:11px;opacity:.8}.ai-message-content{line-height:1.5;font-size:14px}.ai-message-code{background:rgba(0,0,0,.3);padding:8px 12px;border-radius:6px;margin-top:8px;font-family:'Courier New',monospace;font-size:13px;overflow-x:auto}.typing-indicator{display:flex;gap:4px;padding:12px 16px;background:rgba(255,255,255,.1);border-radius:12px;width:fit-content}.typing-dot{width:8px;height:8px;background:#667eea;border-radius:50%;animation:bounce 1.4s infinite ease-in-out}.typing-dot:nth-child(1){animation-delay:0s}.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-10px)}}.ai-input-container{padding:16px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.1);display:flex;gap:8px}.ai-input{flex:1;padding:12px 16px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:12px;color:#fff;font-size:14px;outline:0;transition:all .2s}.ai-input:focus{background:rgba(255,255,255,.15);border-color:#667eea}.ai-input::placeholder{color:rgba(255,255,255,.5)}.ai-send-btn{width:44px;height:44px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;border-radius:12px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.ai-send-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:0 4px 12px rgba(102,126,234,.4)}.ai-send-btn:disabled{opacity:.5;cursor:not-allowed}.ai-quick-actions{padding:12px 16px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.1);display:flex;gap:8px;flex-wrap:wrap}.ai-quick-action{padding:6px 12px;background:rgba(102,126,234,.2);border:1px solid rgba(102,126,234,.3);border-radius:8px;color:#a5b4fc;font-size:12px;cursor:pointer;transition:all .2s}.ai-quick-action:hover{background:rgba(102,126,234,.3);color:#fff;transform:translateY(-2px)}#ai-fab{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;box-shadow:0 4px 20px rgba(102,126,234,.5);display:none;align-items:center;justify-content:center;cursor:pointer;z-index:9998;transition:all .3s;border:2px solid rgba(255,255,255,.2)}#ai-fab.active{display:flex}#ai-fab:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(102,126,234,.7)}#ai-fab i{color:#fff;font-size:24px;animation:pulse 2s infinite}.ai-welcome{text-align:center;padding:40px 20px;color:rgba(255,255,255,.7)}.ai-welcome-icon{font-size:48px;margin-bottom:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.ai-welcome-title{font-size:18px;font-weight:600;margin-bottom:8px;color:#fff}.ai-welcome-text{font-size:13px;line-height:1.6}
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --primary-color: #667eea;
            --primary-dark: #5568d3;
            --secondary-color: #764ba2;
            --success-color: #10b981;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
            --info-color: #3b82f6;
            --dark-bg: #0f172a;
            --dark-card: #1e293b;
            --dark-border: #334155;
            --light-bg: #f8fafc;
            --light-card: #ffffff;
            --light-border: #e2e8f0;
            --text-dark: #0f172a;
            --text-light: #f8fafc;
            --text-muted: #64748b;
            --sidebar-width: 280px;
            --sidebar-collapsed: 80px;
            --header-height: 70px;
            --transition-speed: 0.3s;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: var(--light-bg);
            overflow-x: hidden;
            transition: background var(--transition-speed);
        }

        body.dark-mode {
            background: var(--dark-bg);
            color: var(--text-light);
        }

        /* ===== LAYOUT ===== */
        .dashboard-layout {
            display: flex;
            min-height: 100vh;
            position: relative;
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            height: 100vh;
            width: var(--sidebar-width);
            background: var(--light-card);
            border-right: 1px solid var(--light-border);
            transition: all var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 1000;
            overflow-y: auto;
            overflow-x: hidden;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.05);
        }

        body.dark-mode .sidebar {
            background: var(--dark-card);
            border-right-color: var(--dark-border);
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
        }

        .sidebar.collapsed {
            width: var(--sidebar-collapsed);
        }

        .sidebar::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: transparent;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 10px;
        }

        /* Logo Area */
        .sidebar-logo {
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border-bottom: 1px solid var(--light-border);
            transition: all var(--transition-speed);
        }

        body.dark-mode .sidebar-logo {
            border-bottom-color: var(--dark-border);
        }

        .sidebar.collapsed .sidebar-logo {
            justify-content: center;
            padding: 1.5rem 0.5rem;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-gradient);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            background: var(--primary-gradient);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            white-space: nowrap;
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .logo-text {
            opacity: 0;
            width: 0;
        }

        /* Navigation */
        .sidebar-nav {
            padding: 1.5rem 0;
        }

        .nav-section {
            margin-bottom: 2rem;
        }

        .nav-section-title {
            padding: 0 1.5rem;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.75rem;
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .nav-section-title {
            opacity: 0;
            height: 0;
            margin: 0;
            padding: 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.875rem 1.5rem;
            margin: 0.25rem 0.75rem;
            border-radius: 12px;
            cursor: pointer;
            transition: all var(--transition-speed);
            position: relative;
            color: var(--text-dark);
            text-decoration: none;
        }

        body.dark-mode .nav-item {
            color: var(--text-light);
        }

        .sidebar.collapsed .nav-item {
            justify-content: center;
            padding: 0.875rem;
            margin: 0.25rem auto;
            width: 50px;
        }

        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(4px);
        }

        .sidebar.collapsed .nav-item:hover {
            transform: translateX(0) scale(1.1);
        }

        .nav-item.active {
            background: var(--primary-gradient);
            color: white;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .nav-item.active:hover {
            transform: translateX(4px) scale(1.02);
        }

        .sidebar.collapsed .nav-item.active:hover {
            transform: translateX(0) scale(1.1);
        }

        .nav-item-icon {
            font-size: 1.25rem;
            width: 24px;
            text-align: center;
            flex-shrink: 0;
        }

        .nav-item-text {
            font-weight: 500;
            font-size: 0.95rem;
            white-space: nowrap;
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .nav-item-text {
            opacity: 0;
            width: 0;
        }

        .nav-item-badge {
            margin-left: auto;
            background: var(--danger-color);
            color: white;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            min-width: 20px;
            text-align: center;
        }

        .sidebar.collapsed .nav-item-badge {
            position: absolute;
            top: 8px;
            right: 8px;
            padding: 0.15rem 0.35rem;
            font-size: 0.6rem;
        }

        /* User Profile in Sidebar */
        .sidebar-user {
            padding: 1.5rem;
            border-top: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all var(--transition-speed);
            margin-top: auto;
        }

        body.dark-mode .sidebar-user {
            border-top-color: var(--dark-border);
        }

        .sidebar.collapsed .sidebar-user {
            justify-content: center;
            padding: 1.5rem 0.5rem;
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: var(--primary-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            flex-shrink: 0;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .user-info {
            flex: 1;
            overflow: hidden;
            transition: opacity var(--transition-speed);
        }

        .sidebar.collapsed .user-info {
            opacity: 0;
            width: 0;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .user-role {
            font-size: 0.8rem;
            color: var(--text-muted);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            margin-left: var(--sidebar-width);
            transition: margin-left var(--transition-speed) cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            flex-direction: column;
            min-height: 100vh;
        }

        .sidebar.collapsed ~ .main-content {
            margin-left: var(--sidebar-collapsed);
        }

        /* Header */
        .header {
            height: var(--header-height);
            background: var(--light-card);
            border-bottom: 1px solid var(--light-border);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 900;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            transition: all var(--transition-speed);
        }

        body.dark-mode .header {
            background: var(--dark-card);
            border-bottom-color: var(--dark-border);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .toggle-sidebar-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: rgba(102, 126, 234, 0.1);
            color: var(--primary-color);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed);
            font-size: 1.2rem;
        }

        .toggle-sidebar-btn:hover {
            background: rgba(102, 126, 234, 0.2);
            transform: scale(1.1);
        }

        .search-box {
            position: relative;
            width: 350px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 1px solid var(--light-border);
            border-radius: 12px;
            font-size: 0.95rem;
            background: var(--light-bg);
            transition: all var(--transition-speed);
        }

        body.dark-mode .search-input {
            background: var(--dark-bg);
            border-color: var(--dark-border);
            color: var(--text-light);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .header-btn {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            border: none;
            background: var(--light-bg);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all var(--transition-speed);
            position: relative;
            color: var(--text-dark);
        }

        body.dark-mode .header-btn {
            background: var(--dark-bg);
            color: var(--text-light);
        }

        .header-btn:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: scale(1.1);
        }

        .header-btn.active {
            background: var(--primary-gradient);
            color: white;
        }

        .notification-badge {
            position: absolute;
            top: 6px;
            right: 6px;
            width: 18px;
            height: 18px;
            background: var(--danger-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.65rem;
            font-weight: 700;
            color: white;
            border: 2px solid var(--light-card);
        }

        body.dark-mode .notification-badge {
            border-color: var(--dark-card);
        }

        /* Content Area */
        .content-wrapper {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
            position: relative;
        }

        .page-content {
            max-width: 100%;
            height: 100%;
        }

        .content-iframe {
            width: 100%;
            height: calc(100vh - var(--header-height) - 4rem);
            border: none;
            border-radius: 12px;
            background: white;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
        }

        body.dark-mode .content-iframe {
            background: var(--dark-card);
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            transition: opacity var(--transition-speed);
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Mobile Menu Overlay */
        .mobile-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity var(--transition-speed);
        }

        .mobile-overlay.active {
            opacity: 1;
            pointer-events: all;
        }

        /* ===== RESPONSIVE ===== */
        
        /* Tablet */
        @media (max-width: 1024px) {
            :root {
                --sidebar-width: 240px;
            }

            .search-box {
                width: 250px;
            }

            .header {
                padding: 0 1.5rem;
            }

            .content-wrapper {
                padding: 1.5rem;
            }
        }

        /* Mobile */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0 !important;
            }

            .header {
                padding: 0 1rem;
            }

            .search-box {
                display: none;
            }

            .header-actions {
                gap: 0.5rem;
            }

            .content-wrapper {
                padding: 1rem;
            }

            .content-iframe {
                height: calc(100vh - var(--header-height) - 2rem);
                border-radius: 8px;
            }

            .nav-item {
                margin: 0.25rem 0.5rem;
            }
        }

        /* Small Mobile */
        @media (max-width: 480px) {
            .header-left h2 {
                font-size: 1rem;
            }

            .user-name {
                font-size: 0.85rem;
            }

            .logo-text {
                font-size: 1rem;
            }
        }

        /* Ultra-wide screens */
        @media (min-width: 1920px) {
            .content-wrapper {
                padding: 3rem;
            }

            .content-iframe {
                height: calc(100vh - var(--header-height) - 6rem);
            }
        }

        /* Animations */
        @keyframes slideInFromLeft {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .animate-slide-in {
            animation: slideInFromLeft 0.4s ease-out;
        }

        .animate-fade-in {
            animation: fadeIn 0.3s ease-out;
        }

        /* Dark mode toggle switch */
        .theme-switch {
            position: relative;
            width: 50px;
            height: 26px;
        }

        .theme-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--light-border);
            transition: 0.4s;
            border-radius: 34px;
        }

        body.dark-mode .theme-slider {
            background-color: var(--primary-color);
        }

        .theme-slider:before {
            position: absolute;
            content: "";
            height: 20px;
            width: 20px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: 0.4s;
            border-radius: 50%;
        }

        .theme-switch input:checked + .theme-slider:before {
            transform: translateX(24px);
        }

        .theme-icon {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75rem;
            transition: opacity 0.3s;
        }

        .theme-icon-sun {
            left: 6px;
            color: #fbbf24;
        }

        .theme-icon-moon {
            right: 6px;
            color: white;
        }

        /* Print styles */
        @media print {
            .sidebar,
            .header {
                display: none !important;
            }

            .main-content {
                margin-left: 0 !important;
            }
        }

        /* Accessibility */
        .nav-item:focus,
        .header-btn:focus,
        .toggle-sidebar-btn:focus {
            outline: 2px solid var(--primary-color);
            outline-offset: 2px;
        }

        /* Smooth scrolling */
        html {
            scroll-behavior: smooth;
        }

        /* Selection color */
        ::selection {
            background: var(--primary-color);
            color: white;
        }

/* ===== PHASE 1 ENHANCEMENTS ===== */
/* Animation Keyframes supplémentaires */
@keyframes slideInUp {
    from {
        opacity: 0;
        transform: translateY(30px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInLeft {
    from {
        opacity: 0;
        transform: translateX(-30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes slideInRight {
    from {
        opacity: 0;
        transform: translateX(30px);
    }
    to {
        opacity: 1;
        transform: translateX(0);
    }
}

@keyframes scaleIn {
    from {
        opacity: 0;
        transform: scale(0.9);
    }
    to {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes fadeIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}

@keyframes shimmer {
    0% {
        background-position: -1000px 0;
    }
    100% {
        background-position: 1000px 0;
    }
}

@keyframes float {
    0%, 100% {
        transform: translateY(0px);
    }
    50% {
        transform: translateY(-10px);
    }
}

@keyframes glow {
    0%, 100% {
        box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
    }
    50% {
        box-shadow: 0 0 30px rgba(102, 126, 234, 0.8), 0 0 40px rgba(118, 75, 162, 0.6);
    }
}

/* Classes d'animation utilitaires */
.animate-slide-up {
    animation: slideInUp 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.animate-slide-left {
    animation: slideInLeft 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.animate-slide-right {
    animation: slideInRight 0.6s cubic-bezier(0.16, 1, 0.3, 1);
}

.animate-scale-in {
    animation: scaleIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
}

.animate-fade-in {
    animation: fadeIn 0.5s ease-out;
}

.animate-float {
    animation: float 3s ease-in-out infinite;
}

/* Stagger animations (délai progressif) */
.animate-stagger-1 { animation-delay: 0.1s; }
.animate-stagger-2 { animation-delay: 0.2s; }
.animate-stagger-3 { animation-delay: 0.3s; }
.animate-stagger-4 { animation-delay: 0.4s; }

/* ===== QUICK STATS SECTION ===== */
.quick-stats-section {
    margin-bottom: 2rem;
    padding: 0;
}

.quick-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: var(--light-card);
    border: 1px solid var(--light-border);
    border-radius: 16px;
    padding: 1.5rem;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    cursor: pointer;
}

body.dark-mode .stat-card {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: var(--primary-gradient);
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.3s ease;
}

.stat-card:hover::before {
    transform: scaleX(1);
}

.stat-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-color);
}

body.dark-mode .stat-card:hover {
    box-shadow: 0 12px 24px rgba(0, 0, 0, 0.4);
}

.stat-card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
}

.stat-card-icon {
    width: 48px;
    height: 48px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    transition: all 0.3s ease;
}

.stat-card:hover .stat-card-icon {
    transform: scale(1.1) rotate(5deg);
}

.stat-card-icon.success {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
    color: var(--success-color);
}

.stat-card-icon.warning {
    background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.2) 100%);
    color: var(--warning-color);
}

.stat-card-icon.info {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.2) 100%);
    color: var(--info-color);
}

.stat-card-icon.primary {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.2) 100%);
    color: var(--primary-color);
}

.stat-card-trend {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
}

.stat-card-trend.up {
    background: rgba(16, 185, 129, 0.1);
    color: var(--success-color);
}

.stat-card-trend.down {
    background: rgba(239, 68, 68, 0.1);
    color: var(--danger-color);
}

.stat-card-body {
    margin-bottom: 0.75rem;
}

.stat-card-value {
    font-size: 2rem;
    font-weight: 800;
    color: var(--text-dark);
    line-height: 1.2;
    margin-bottom: 0.25rem;
}

body.dark-mode .stat-card-value {
    color: var(--text-light);
}

.stat-card-label {
    font-size: 0.875rem;
    color: var(--text-muted);
    font-weight: 500;
}

.stat-card-footer {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding-top: 0.75rem;
    border-top: 1px solid var(--light-border);
    font-size: 0.75rem;
    color: var(--text-muted);
}

body.dark-mode .stat-card-footer {
    border-top-color: var(--dark-border);
}

.stat-card-footer i {
    font-size: 0.875rem;
}

/* ===== GLASSMORPHISM EFFECT ===== */
.glass-effect {
    background: rgba(255, 255, 255, 0.7);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.3);
}

body.dark-mode .glass-effect {
    background: rgba(30, 41, 59, 0.7);
    border: 1px solid rgba(255, 255, 255, 0.1);
}

/* ===== SMOOTH TRANSITIONS ===== */
* {
    transition-property: background-color, border-color, color, fill, stroke;
    transition-duration: 0.2s;
    transition-timing-function: cubic-bezier(0.4, 0, 0.2, 1);
}

button, a, .nav-item, .stat-card {
    transition-property: all;
    transition-duration: 0.3s;
}

/* ===== ENHANCED HEADER ===== */
.header {
    backdrop-filter: blur(20px);
    -webkit-backdrop-filter: blur(20px);
    background: rgba(255, 255, 255, 0.8);
    border-bottom: 1px solid rgba(226, 232, 240, 0.5);
}

body.dark-mode .header {
    background: rgba(30, 41, 59, 0.8);
    border-bottom-color: rgba(51, 65, 85, 0.5);
}

/* ===== IMPROVED SCROLLBAR ===== */
::-webkit-scrollbar {
    width: 12px;
    height: 12px;
}

::-webkit-scrollbar-track {
    background: transparent;
}

::-webkit-scrollbar-thumb {
    background: linear-gradient(180deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    border-radius: 10px;
    border: 3px solid transparent;
    background-clip: padding-box;
}

::-webkit-scrollbar-thumb:hover {
    background: linear-gradient(180deg, var(--primary-dark) 0%, var(--secondary-color) 100%);
    background-clip: padding-box;
}

/* ===== MICRO INTERACTIONS ===== */
.hover-lift {
    transition: transform 0.2s ease;
}

.hover-lift:hover {
    transform: translateY(-3px);
}

.hover-scale {
    transition: transform 0.2s ease;
}

.hover-scale:hover {
    transform: scale(1.05);
}

.hover-glow:hover {
    animation: glow 2s ease-in-out infinite;
}

/* ===== PAGE TRANSITION ===== */
.page-content {
    animation: fadeIn 0.4s ease-out;
}

/* ===== SKELETON LOADING (pour future use) ===== */
.skeleton {
    background: linear-gradient(
        90deg,
        rgba(200, 200, 200, 0.2) 25%,
        rgba(200, 200, 200, 0.3) 50%,
        rgba(200, 200, 200, 0.2) 75%
    );
    background-size: 200% 100%;
    animation: shimmer 1.5s infinite;
    border-radius: 8px;
}

body.dark-mode .skeleton {
    background: linear-gradient(
        90deg,
        rgba(50, 50, 50, 0.2) 25%,
        rgba(50, 50, 50, 0.3) 50%,
        rgba(50, 50, 50, 0.2) 75%
    );
    background-size: 200% 100%;
}

/* ===== PHASE 2 ENHANCEMENTS ===== */

/* ===== PHASE2-SEARCH-CSS ===== */
/* Global Search Enhanced */
.search-box {
    position: relative;
    width: 100%;
    max-width: 500px;
}

.search-input {
    width: 100%;
    padding: 0.75rem 2.5rem 0.75rem 2.5rem;
    border: 2px solid var(--light-border);
    border-radius: 12px;
    font-size: 0.95rem;
    transition: all 0.3s ease;
    background: var(--light-card);
}

body.dark-mode .search-input {
    background: var(--dark-card);
    border-color: var(--dark-border);
    color: var(--text-light);
}

.search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
}

.search-icon {
    position: absolute;
    left: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-muted);
    pointer-events: none;
}

.search-clear {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: all 0.2s;
    display: none;
}

.search-input:not(:placeholder-shown) ~ .search-clear {
    display: block;
}

.search-clear:hover {
    background: var(--light-border);
    color: var(--text-dark);
}

body.dark-mode .search-clear:hover {
    background: var(--dark-border);
    color: var(--text-light);
}

/* Search Results Dropdown */
.search-results {
    position: absolute;
    top: calc(100% + 0.5rem);
    left: 0;
    right: 0;
    background: var(--light-card);
    border: 2px solid var(--light-border);
    border-radius: 12px;
    max-height: 400px;
    overflow-y: auto;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
    z-index: 1000;
    display: none;
}

body.dark-mode .search-results {
    background: var(--dark-card);
    border-color: var(--dark-border);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
}

.search-results.active {
    display: block;
    animation: slideInUp 0.2s ease-out;
}

.search-results-header {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--light-border);
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-muted);
}

body.dark-mode .search-results-header {
    border-bottom-color: var(--dark-border);
}

.search-result-item {
    padding: 0.75rem 1rem;
    display: flex;
    align-items: center;
    gap: 1rem;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 1px solid var(--light-border);
}

body.dark-mode .search-result-item {
    border-bottom-color: var(--dark-border);
}

.search-result-item:last-child {
    border-bottom: none;
}

.search-result-item:hover,
.search-result-item.selected {
    background: var(--light-bg);
}

body.dark-mode .search-result-item:hover,
body.dark-mode .search-result-item.selected {
    background: rgba(102, 126, 234, 0.1);
}

.search-result-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    flex-shrink: 0;
}

.search-result-icon.page {
    background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.2) 100%);
    color: var(--primary-color);
}

.search-result-icon.server {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.2) 100%);
    color: var(--success-color);
}

.search-result-icon.action {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(59, 130, 246, 0.2) 100%);
    color: var(--info-color);
}

.search-result-content {
    flex: 1;
    min-width: 0;
}

.search-result-title {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

body.dark-mode .search-result-title {
    color: var(--text-light);
}

.search-result-desc {
    font-size: 0.85rem;
    color: var(--text-muted);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.search-result-badge {
    padding: 0.25rem 0.75rem;
    border-radius: 6px;
    font-size: 0.75rem;
    font-weight: 600;
    background: var(--light-bg);
    color: var(--text-muted);
}

body.dark-mode .search-result-badge {
    background: var(--dark-border);
}

.search-no-results {
    padding: 2rem;
    text-align: center;
    color: var(--text-muted);
}

/* Search Keyboard Hint */
.search-keyboard-hint {
    position: absolute;
    right: 3rem;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    gap: 0.25rem;
    pointer-events: none;
}

.search-input:focus ~ .search-keyboard-hint {
    display: none;
}

.kbd {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 1.5rem;
    height: 1.5rem;
    padding: 0 0.375rem;
    background: var(--light-bg);
    border: 1px solid var(--light-border);
    border-radius: 4px;
    font-size: 0.75rem;
    font-family: 'Courier New', monospace;
    color: var(--text-muted);
    box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

body.dark-mode .kbd {
    background: var(--dark-border);
    border-color: var(--dark-bg);
}

/* ===== PHASE2-BREADCRUMBS-CSS ===== */
.breadcrumbs {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--light-card);
    border-bottom: 1px solid var(--light-border);
    font-size: 0.9rem;
    overflow-x: auto;
    white-space: nowrap;
}

body.dark-mode .breadcrumbs {
    background: var(--dark-card);
    border-bottom-color: var(--dark-border);
}

.breadcrumbs::-webkit-scrollbar {
    height: 4px;
}

.breadcrumb-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--text-muted);
    text-decoration: none;
    transition: color 0.2s;
}

.breadcrumb-item:hover {
    color: var(--primary-color);
}

.breadcrumb-item.active {
    color: var(--text-dark);
    font-weight: 600;
}

body.dark-mode .breadcrumb-item.active {
    color: var(--text-light);
}

.breadcrumb-separator {
    color: var(--text-muted);
    font-size: 0.75rem;
}

.breadcrumb-icon {
    font-size: 0.9rem;
}

/* ===== PHASE2-MOBILE-CSS ===== */
/* Mobile Breakpoints */
@media (max-width: 768px) {
    .sidebar {
        transform: translateX(-100%);
        z-index: 2000;
    }
    
    .sidebar.mobile-open {
        transform: translateX(0);
    }
    
    .main-content {
        margin-left: 0 !important;
    }
    
    .header {
        padding: 0.75rem 1rem;
    }
    
    .search-box {
        max-width: none;
    }
    
    .header-actions {
        gap: 0.5rem;
    }
    
    .header-btn {
        width: 40px;
        height: 40px;
    }
    
    /* Quick Stats Mobile */
    .quick-stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .stat-card {
        padding: 1rem;
    }
    
    .stat-card-value {
        font-size: 1.5rem;
    }
    
    /* Breadcrumbs Mobile */
    .breadcrumbs {
        padding: 0.5rem 1rem;
        font-size: 0.85rem;
    }
    
    /* AI Assistant Mobile */
    #ai-assistant-panel {
        bottom: 10px;
        right: 10px;
        left: 10px;
        width: auto;
        max-height: 500px;
    }
    
    #ai-assistant-panel.minimized {
        left: auto;
        width: 200px;
    }
}

/* Mobile Bottom Navigation (optional) */
.mobile-bottom-nav {
    display: none;
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--light-card);
    border-top: 1px solid var(--light-border);
    padding: 0.75rem;
    z-index: 1500;
    box-shadow: 0 -4px 20px rgba(0, 0, 0, 0.1);
}

body.dark-mode .mobile-bottom-nav {
    background: var(--dark-card);
    border-top-color: var(--dark-border);
}

@media (max-width: 768px) {
    .mobile-bottom-nav {
        display: flex;
        justify-content: space-around;
        align-items: center;
    }
    
    .main-content {
        padding-bottom: 80px;
    }
}

.mobile-nav-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    color: var(--text-muted);
    text-decoration: none;
    transition: all 0.2s;
    font-size: 0.75rem;
}

.mobile-nav-item.active {
    color: var(--primary-color);
    background: rgba(102, 126, 234, 0.1);
}

.mobile-nav-item i {
    font-size: 1.25rem;
}

/* Touch Gestures */
.swipe-hint {
    position: fixed;
    top: 50%;
    left: 20px;
    transform: translateY(-50%);
    background: var(--dark-card);
    color: var(--text-light);
    padding: 0.75rem 1rem;
    border-radius: 8px;
    font-size: 0.85rem;
    display: none;
    animation: slideInLeft 0.3s ease-out;
    z-index: 2001;
}

@media (max-width: 768px) {
    .swipe-hint.active {
        display: block;
    }
}

/* ===== PHASE2-CONTEXT-MENU-CSS ===== */
.context-menu {
    position: fixed;
    background: var(--light-card);
    border: 2px solid var(--light-border);
    border-radius: 12px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
    min-width: 200px;
    z-index: 10000;
    display: none;
    animation: scaleIn 0.15s ease-out;
}

body.dark-mode .context-menu {
    background: var(--dark-card);
    border-color: var(--dark-border);
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
}

.context-menu.active {
    display: block;
}

.context-menu-item {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    cursor: pointer;
    transition: all 0.2s;
    border-bottom: 1px solid var(--light-border);
}

body.dark-mode .context-menu-item {
    border-bottom-color: var(--dark-border);
}

.context-menu-item:last-child {
    border-bottom: none;
}

.context-menu-item:hover {
    background: var(--light-bg);
}

body.dark-mode .context-menu-item:hover {
    background: rgba(102, 126, 234, 0.1);
}

.context-menu-icon {
    width: 20px;
    text-align: center;
    color: var(--text-muted);
}

.context-menu-label {
    flex: 1;
    color: var(--text-dark);
    font-size: 0.9rem;
}

body.dark-mode .context-menu-label {
    color: var(--text-light);
}

.context-menu-shortcut {
    font-size: 0.75rem;
    color: var(--text-muted);
    font-family: 'Courier New', monospace;
}

.context-menu-separator {
    height: 1px;
    background: var(--light-border);
    margin: 0.25rem 0;
}

body.dark-mode .context-menu-separator {
    background: var(--dark-border);
}

/* ===== PHASE2-SHORTCUTS-MODAL-CSS ===== */
.shortcuts-modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    animation: fadeIn 0.2s ease-out;
}

.shortcuts-modal.active {
    display: flex;
}

.shortcuts-modal-content {
    background: var(--light-card);
    border-radius: 20px;
    max-width: 700px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
    animation: scaleIn 0.3s ease-out;
}

body.dark-mode .shortcuts-modal-content {
    background: var(--dark-card);
}

.shortcuts-modal-header {
    padding: 2rem;
    border-bottom: 2px solid var(--light-border);
    text-align: center;
}

body.dark-mode .shortcuts-modal-header {
    border-bottom-color: var(--dark-border);
}

.shortcuts-modal-title {
    font-size: 1.75rem;
    font-weight: 800;
    margin-bottom: 0.5rem;
    background: var(--primary-gradient);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
}

.shortcuts-modal-subtitle {
    color: var(--text-muted);
    font-size: 0.95rem;
}

.shortcuts-modal-body {
    padding: 2rem;
}

.shortcuts-section {
    margin-bottom: 2rem;
}

.shortcuts-section:last-child {
    margin-bottom: 0;
}

.shortcuts-section-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

body.dark-mode .shortcuts-section-title {
    color: var(--text-light);
}

.shortcut-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0.75rem 1rem;
    background: var(--light-bg);
    border-radius: 10px;
    margin-bottom: 0.5rem;
    transition: all 0.2s;
}

body.dark-mode .shortcut-item {
    background: rgba(255, 255, 255, 0.05);
}

.shortcut-item:hover {
    background: rgba(102, 126, 234, 0.1);
    transform: translateX(5px);
}

.shortcut-desc {
    color: var(--text-dark);
    font-size: 0.95rem;
}

body.dark-mode .shortcut-desc {
    color: var(--text-light);
}

.shortcut-keys {
    display: flex;
    gap: 0.5rem;
}

.shortcuts-modal-footer {
    padding: 1.5rem 2rem;
    border-top: 2px solid var(--light-border);
    display: flex;
    justify-content: center;
}

body.dark-mode .shortcuts-modal-footer {
    border-top-color: var(--dark-border);
}

.shortcuts-close-btn {
    background: var(--primary-gradient);
    color: white;
    padding: 0.75rem 2rem;
    border-radius: 10px;
    border: none;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
}

.shortcuts-close-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
}

/* ===== PHASE 3 ENHANCEMENTS ===== */

/* ===== PHASE3-PWA-CSS ===== */
/* PWA Install Banner */
.pwa-install-banner {
    position: fixed;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 1rem 2rem;
    border-radius: 16px;
    box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
    z-index: 9998;
    display: none;
    align-items: center;
    gap: 1rem;
    animation: slideInUp 0.4s ease-out;
    max-width: 90%;
}

.pwa-install-banner.active {
    display: flex;
}

.pwa-install-content {
    flex: 1;
}

.pwa-install-title {
    font-weight: 700;
    font-size: 1.1rem;
    margin-bottom: 0.25rem;
}

.pwa-install-desc {
    font-size: 0.9rem;
    opacity: 0.95;
}

.pwa-install-btn {
    background: white;
    color: #667eea;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    border: none;
    font-weight: 700;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
}

.pwa-install-btn:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(255, 255, 255, 0.3);
}

.pwa-install-close {
    background: rgba(255, 255, 255, 0.2);
    border: none;
    color: white;
    width: 32px;
    height: 32px;
    border-radius: 50%;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.2s;
}

.pwa-install-close:hover {
    background: rgba(255, 255, 255, 0.3);
}

/* PWA Update Banner */
.pwa-update-banner {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #10b981;
    color: white;
    padding: 1rem 1.5rem;
    border-radius: 12px;
    box-shadow: 0 10px 30px rgba(16, 185, 129, 0.4);
    z-index: 9998;
    display: none;
    animation: slideInRight 0.4s ease-out;
}

.pwa-update-banner.active {
    display: block;
}

@media (max-width: 768px) {
    .pwa-install-banner {
        flex-direction: column;
        text-align: center;
        padding: 1.5rem;
    }
}

/* ===== PHASE3-DASHBOARD-CUSTOM-CSS ===== */
/* Dashboard Customization Toggle */
.dashboard-customize-toggle {
    position: fixed;
    bottom: 100px;
    right: 20px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    border-radius: 50%;
    box-shadow: 0 4px 20px rgba(102, 126, 234, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    z-index: 9997;
    transition: all 0.3s;
    border: 3px solid white;
}

.dashboard-customize-toggle:hover {
    transform: scale(1.1);
    box-shadow: 0 6px 30px rgba(102, 126, 234, 0.7);
}

.dashboard-customize-toggle i {
    color: white;
    font-size: 1.5rem;
}

.dashboard-customize-toggle.active {
    background: #10b981;
}

/* Customizable Dashboard Grid */
.customizable-dashboard {
    display: none;
}

.customizable-dashboard.active {
    display: block;
}

.grid-stack {
    background: transparent;
}

.grid-stack-item {
    background: var(--light-card);
    border-radius: 16px;
    border: 2px solid var(--light-border);
    overflow: hidden;
    transition: all 0.3s;
}

body.dark-mode .grid-stack-item {
    background: var(--dark-card);
    border-color: var(--dark-border);
}

.grid-stack-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
}

body.dark-mode .grid-stack-item:hover {
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
}

.grid-stack-item-content {
    padding: 1.5rem;
    height: 100%;
    overflow: auto;
}

/* Widget Styles */
.widget {
    height: 100%;
    display: flex;
    flex-direction: column;
}

.widget-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--light-border);
}

body.dark-mode .widget-header {
    border-bottom-color: var(--dark-border);
}

.widget-title {
    font-size: 1.1rem;
    font-weight: 700;
    color: var(--text-dark);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

body.dark-mode .widget-title {
    color: var(--text-light);
}

.widget-actions {
    display: flex;
    gap: 0.5rem;
}

.widget-action-btn {
    background: none;
    border: none;
    color: var(--text-muted);
    cursor: pointer;
    padding: 0.25rem 0.5rem;
    border-radius: 6px;
    transition: all 0.2s;
}

.widget-action-btn:hover {
    background: var(--light-bg);
    color: var(--text-dark);
}

body.dark-mode .widget-action-btn:hover {
    background: var(--dark-border);
    color: var(--text-light);
}

.widget-body {
    flex: 1;
    overflow: auto;
}

/* Widget Library Panel */
.widget-library {
    position: fixed;
    top: 80px;
    right: -350px;
    width: 320px;
    height: calc(100vh - 100px);
    background: var(--light-card);
    border-left: 2px solid var(--light-border);
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.1);
    z-index: 9996;
    transition: right 0.3s ease;
    padding: 1.5rem;
    overflow-y: auto;
}

body.dark-mode .widget-library {
    background: var(--dark-card);
    border-left-color: var(--dark-border);
    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.3);
}

.widget-library.active {
    right: 0;
}

.widget-library-title {
    font-size: 1.25rem;
    font-weight: 800;
    margin-bottom: 1rem;
    color: var(--text-dark);
}

body.dark-mode .widget-library-title {
    color: var(--text-light);
}

.widget-template {
    background: var(--light-bg);
    padding: 1rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    cursor: grab;
    border: 2px solid transparent;
    transition: all 0.2s;
}

body.dark-mode .widget-template {
    background: rgba(255, 255, 255, 0.05);
}

.widget-template:hover {
    border-color: var(--primary-color);
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
}

.widget-template-icon {
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.widget-template-name {
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

body.dark-mode .widget-template-name {
    color: var(--text-light);
}

.widget-template-desc {
    font-size: 0.85rem;
    color: var(--text-muted);
}

/* ===== PHASE3-ANALYTICS-CSS ===== */
/* Analytics Badge */
.analytics-badge {
    position: fixed;
    bottom: 20px;
    left: 20px;
    background: rgba(15, 23, 42, 0.9);
    backdrop-filter: blur(10px);
    color: white;
    padding: 0.75rem 1rem;
    border-radius: 10px;
    font-size: 0.85rem;
    z-index: 9995;
    display: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
}

.analytics-badge.active {
    display: block;
}

.analytics-badge-label {
    opacity: 0.7;
    margin-right: 0.5rem;
}

.analytics-badge-value {
    font-weight: 700;
    color: #10b981;
}



    </style>
<style>

/* ===== AI ASSISTANT STYLES - Extracted from ai-assistant-panel.html ===== */
#ai-assistant-panel{position:fixed;bottom:20px;right:20px;width:400px;max-height:600px;background:linear-gradient(135deg,#1e293b 0%,#0f172a 100%);border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,.5);z-index:9999;display:flex;flex-direction:column;transition:all .3s cubic-bezier(.4,0,.2,1);overflow:hidden;border:1px solid rgba(102,126,234,.3)}#ai-assistant-panel.minimized{max-height:60px}#ai-assistant-panel.hidden{transform:translateX(500px);opacity:0;pointer-events:none}.ai-panel-header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);padding:16px;display:flex;align-items:center;justify-content:space-between;cursor:pointer;user-select:none}.ai-panel-title{display:flex;align-items:center;gap:10px;color:#fff;font-weight:600;font-size:16px}.ai-panel-icon{font-size:20px;animation:pulse 2s infinite}@keyframes pulse{0%,100%{opacity:1}50%{opacity:.6}}.ai-panel-controls{display:flex;gap:8px}.ai-panel-btn{width:32px;height:32px;border-radius:8px;background:rgba(255,255,255,.1);border:none;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.ai-panel-btn:hover{background:rgba(255,255,255,.2);transform:scale(1.05)}.ai-server-context{padding:8px 16px;background:rgba(16,185,129,.1);border-bottom:1px solid rgba(16,185,129,.2);display:flex;align-items:center;gap:8px;font-size:12px;color:#10b981}.ai-server-context.no-server{background:rgba(245,158,11,.1);border-bottom-color:rgba(245,158,11,.2);color:#f59e0b}.server-indicator{width:8px;height:8px;background:#10b981;border-radius:50%;animation:blink 2s infinite}.server-indicator.disconnected{background:#f59e0b}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}.ai-chat-container{flex:1;overflow-y:auto;padding:16px;display:flex;flex-direction:column;gap:12px;min-height:300px;max-height:400px}.ai-chat-container::-webkit-scrollbar{width:6px}.ai-chat-container::-webkit-scrollbar-track{background:rgba(255,255,255,.05);border-radius:10px}.ai-chat-container::-webkit-scrollbar-thumb{background:rgba(102,126,234,.5);border-radius:10px}.ai-message{padding:12px 16px;border-radius:12px;max-width:85%;word-wrap:break-word;animation:slideIn .3s ease}@keyframes slideIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.ai-message.user{align-self:flex-end;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;margin-left:auto}.ai-message.assistant{align-self:flex-start;background:rgba(255,255,255,.1);color:#fff;border:1px solid rgba(102,126,234,.3)}.ai-message.system{align-self:center;background:rgba(59,130,246,.1);color:#3b82f6;font-size:12px;border:1px solid rgba(59,130,246,.3);text-align:center;max-width:100%}.ai-message-header{display:flex;align-items:center;gap:6px;margin-bottom:6px;font-size:11px;opacity:.8}.ai-message-content{line-height:1.5;font-size:14px}.ai-message-code{background:rgba(0,0,0,.3);padding:8px 12px;border-radius:6px;margin-top:8px;font-family:'Courier New',monospace;font-size:13px;overflow-x:auto}.typing-indicator{display:flex;gap:4px;padding:12px 16px;background:rgba(255,255,255,.1);border-radius:12px;width:fit-content}.typing-dot{width:8px;height:8px;background:#667eea;border-radius:50%;animation:bounce 1.4s infinite ease-in-out}.typing-dot:nth-child(1){animation-delay:0s}.typing-dot:nth-child(2){animation-delay:.2s}.typing-dot:nth-child(3){animation-delay:.4s}@keyframes bounce{0%,60%,100%{transform:translateY(0)}30%{transform:translateY(-10px)}}.ai-input-container{padding:16px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.1);display:flex;gap:8px}.ai-input{flex:1;padding:12px 16px;background:rgba(255,255,255,.1);border:1px solid rgba(255,255,255,.2);border-radius:12px;color:#fff;font-size:14px;outline:0;transition:all .2s}.ai-input:focus{background:rgba(255,255,255,.15);border-color:#667eea}.ai-input::placeholder{color:rgba(255,255,255,.5)}.ai-send-btn{width:44px;height:44px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border:none;border-radius:12px;color:#fff;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s}.ai-send-btn:hover:not(:disabled){transform:scale(1.05);box-shadow:0 4px 12px rgba(102,126,234,.4)}.ai-send-btn:disabled{opacity:.5;cursor:not-allowed}.ai-quick-actions{padding:12px 16px;background:rgba(255,255,255,.05);border-top:1px solid rgba(255,255,255,.1);display:flex;gap:8px;flex-wrap:wrap}.ai-quick-action{padding:6px 12px;background:rgba(102,126,234,.2);border:1px solid rgba(102,126,234,.3);border-radius:8px;color:#a5b4fc;font-size:12px;cursor:pointer;transition:all .2s}.ai-quick-action:hover{background:rgba(102,126,234,.3);color:#fff;transform:translateY(-2px)}#ai-fab{position:fixed;bottom:20px;right:20px;width:60px;height:60px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);border-radius:50%;box-shadow:0 4px 20px rgba(102,126,234,.5);display:none;align-items:center;justify-content:center;cursor:pointer;z-index:9998;transition:all .3s;border:2px solid rgba(255,255,255,.2)}#ai-fab.active{display:flex}#ai-fab:hover{transform:scale(1.1);box-shadow:0 6px 30px rgba(102,126,234,.7)}#ai-fab i{color:#fff;font-size:24px;animation:pulse 2s infinite}.ai-welcome{text-align:center;padding:40px 20px;color:rgba(255,255,255,.7)}.ai-welcome-icon{font-size:48px;margin-bottom:16px;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);-webkit-background-clip:text;-webkit-text-fill-color:transparent}.ai-welcome-title{font-size:18px;font-weight:600;margin-bottom:8px;color:#fff}.ai-welcome-text{font-size:13px;line-height:1.6}
</style>
    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#667eea">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="VPS DevOps Agent">
    
    <!-- External Libraries for Phase 3 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@10.1.0/dist/gridstack.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/gridstack@10.1.0/dist/gridstack-extra.min.css" />
<script src="https://cdn.jsdelivr.net/npm/gridstack@10.1.0/dist/gridstack-all.js"></script>

<!-- Initialize global functions BEFORE body to prevent ReferenceError -->
<script>
// Create stub functions that will be replaced when DOMContentLoaded fires
window.switchPage = window.switchPage || function(page) { console.log('switchPage stub called for:', page); };
window.toggleSidebar = window.toggleSidebar || function() { console.log('toggleSidebar stub called'); };
window.toggleMobileSidebar = window.toggleMobileSidebar || function() { console.log('toggleMobileSidebar stub called'); };
window.toggleDarkMode = window.toggleDarkMode || function() { console.log("toggleDarkMode stub called"); };
window.handleLogout = window.handleLogout || function() { console.log('handleLogout stub called'); };
window.hideKeyboardShortcuts = window.hideKeyboardShortcuts || function() { console.log('hideKeyboardShortcuts stub called'); };
</script>

<!-- REAL FUNCTIONS DEFINED IMMEDIATELY IN HEAD -->
<script>
console.log('🔧 Defining REAL functions in HEAD (before body parsing)...');

// Define real functions IMMEDIATELY to replace stubs
window.toggleSidebar = function() {
    console.log('✅ REAL toggleSidebar called');
    const sidebar = document.getElementById('sidebar');
    if (!sidebar) {
        console.warn('⚠️ Sidebar not found yet (DOM not ready)');
        return;
    }
    const isSidebarCollapsed = sidebar.classList.contains('collapsed');
    if (window.innerWidth <= 768) {
        window.toggleMobileSidebar();
    } else {
        sidebar.classList.toggle('collapsed');
    }
};

window.toggleMobileSidebar = function() {
    console.log('✅ REAL toggleMobileSidebar called');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('mobile-overlay');
    if (sidebar) sidebar.classList.toggle('mobile-open');
    if (overlay) overlay.classList.toggle('active');
};

window.switchPage = function(pageName) {
    console.log('✅ REAL switchPage called for:', pageName);
    
    const pages = document.querySelectorAll('.page-content');
    const navItems = document.querySelectorAll('.nav-item');
    
    if (pages.length === 0) {
        console.warn('⚠️ Pages not found yet (DOM not ready)');
        return;
    }
    
    pages.forEach(page => page.classList.add('hidden'));
    navItems.forEach(item => item.classList.remove('active'));
    
    const pageElement = document.getElementById(`page-${pageName}`);
    if (pageElement) {
        pageElement.classList.remove('hidden');
    }
    
    const navItem = document.querySelector(`[data-page="${pageName}"]`);
    if (navItem) {
        navItem.classList.add('active');
    }
    
    if (window.innerWidth <= 768) {
        window.toggleMobileSidebar();
    }
    
    const iframe = document.getElementById(`iframe-${pageName}`);
    if (iframe) {
        const token = localStorage.getItem('authToken');
        if (token && iframe.contentWindow) {
            try {
                iframe.contentWindow.postMessage({
                    type: 'AUTH_TOKEN',
                    token: token
                }, window.location.origin);
            } catch (error) {
                console.error('Error sending token:', error);
            }
        }
    }
};

window.toggleDarkMode = function() {
    console.log('✅ REAL toggleDarkMode called');
    document.body.classList.toggle('dark-mode');
    const isDark = document.body.classList.contains('dark-mode');
    localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
    console.log('🌓 Dark mode:', isDark ? 'ON' : 'OFF');
};

window.handleLogout = function() {
    console.log('✅ REAL handleLogout called');
    localStorage.removeItem('authToken');
    window.location.href = '/';
};

window.hideKeyboardShortcuts = function() {
    console.log('✅ REAL hideKeyboardShortcuts called');
    const modal = document.getElementById('keyboard-shortcuts-modal');
    if (modal) {
        modal.classList.add('hidden');
    }
};

console.log('✅ All REAL functions defined in HEAD!');
</script>

</head>
<body>
    <!-- Auth Check moved to main script for proper loading order -->

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay hidden">
        <div class="spinner"></div>
    </div>

    <!-- Mobile Overlay -->
    <div id="mobile-overlay" class="mobile-overlay" onclick="toggleMobileSidebar()"></div>

    <!-- Dashboard Layout -->
    <div class="dashboard-layout">
        <!-- Sidebar -->
        <aside id="sidebar" class="sidebar animate-slide-in">
            <!-- Logo -->
            <div class="sidebar-logo">
                <div class="logo-icon">
                    <i class="fas fa-robot"></i>
                </div>
                <div class="logo-text">DevOps Agent</div>
            </div>

            <!-- Navigation -->
            <nav class="sidebar-nav">
                <!-- Main Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Principal</div>
                    <div class="nav-item active" data-page="chat" onclick="switchPage('chat')">
                        <i class="nav-item-icon fas fa-comments"></i>
                        <span class="nav-item-text">Chat AI</span>
                    </div>
                    <div class="nav-item" data-page="terminal" onclick="switchPage('terminal')">
                        <i class="nav-item-icon fas fa-terminal"></i>
                        <span class="nav-item-text">Terminal SSH</span>
                    </div>
                    <div class="nav-item" data-page="agent" onclick="switchPage('agent')">
                        <i class="nav-item-icon fas fa-robot"></i>
                        <span class="nav-item-text">Agent DevOps</span>
                    </div>
                </div>

                <!-- Development Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Développement</div>
                    <div class="nav-item" data-page="code-analyzer" onclick="switchPage('code-analyzer')">
                        <i class="nav-item-icon fas fa-code"></i>
                        <span class="nav-item-text">Code Analyzer</span>
                    </div>
                    <div class="nav-item" data-page="sandbox" onclick="switchPage('sandbox')">
                        <i class="nav-item-icon fas fa-play"></i>
                        <span class="nav-item-text">Sandbox Playground</span>
                    </div>
                    <div class="nav-item" data-page="monitoring-advanced" onclick="switchPage('monitoring-advanced')">
                        <i class="nav-item-icon fas fa-chart-line"></i>
                        <span class="nav-item-text">Live Monitoring Pro</span>
                        <span class="nav-badge">New</span>
                    </div>
                </div>

                <!-- Management Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Gestion</div>
                    <div class="nav-item" data-page="docker" onclick="switchPage('docker')">
                        <i class="nav-item-icon fab fa-docker"></i>
                        <span class="nav-item-text">Docker</span>
                    </div>
                    <div class="nav-item" data-page="monitoring" onclick="switchPage('monitoring')">
                        <i class="nav-item-icon fas fa-chart-line"></i>
                        <span class="nav-item-text">Monitoring</span>
                    </div>
                    <div class="nav-item" data-page="cicd" onclick="switchPage('cicd')">
                        <i class="nav-item-icon fas fa-rocket"></i>
                        <span class="nav-item-text">CI/CD</span>
                    </div>
                </div>

                <!-- System Section -->
                <div class="nav-section">
                    <div class="nav-section-title">Système</div>
                    <div class="nav-item" data-page="admin-panel" onclick="switchPage('admin-panel')">
                        <i class="nav-item-icon fas fa-user-shield"></i>
                        <span class="nav-item-text">Administration</span>
                        <span class="nav-badge" style="background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);">Admin</span>
                    </div>
                    <div class="nav-item" data-page="subscription-manager" onclick="switchPage('subscription-manager')">
                        <i class="nav-item-icon fas fa-credit-card"></i>
                        <span class="nav-item-text">Abonnements</span>
                    </div>
                    <div class="nav-item" data-page="autonomous-agent" onclick="switchPage('autonomous-agent')">
                        <i class="nav-item-icon fas fa-robot"></i>
                        <span class="nav-item-text">Agent Autonome</span>
                    </div>
                    <div class="nav-item" data-page="projects-manager" onclick="switchPage('projects-manager')">
                        <i class="nav-item-icon fas fa-project-diagram"></i>
                        <span class="nav-item-text">Gestion Projets</span>
                    </div>
                    <div class="nav-item" data-page="enhancements" onclick="switchPage('enhancements')">
                        <i class="nav-item-icon fas fa-rocket"></i>
                        <span class="nav-item-text">API Enhancements</span>
                    </div>
                    <div class="nav-item" data-page="settings" onclick="switchPage('settings')">
                        <i class="nav-item-icon fas fa-cog"></i>
                        <span class="nav-item-text">Paramètres</span>
                    </div>
                </div>
            </nav>

            <!-- User Profile -->
            <div class="sidebar-user">
                <div class="user-avatar" id="user-avatar">A</div>
                <div class="user-info">
                    <div class="user-name" id="user-name">Admin</div>
                    <div class="user-role">Administrateur</div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header animate-fade-in">
                <div class="header-left">
                    <button class="toggle-sidebar-btn" onclick="toggleSidebar()" aria-label="Toggle Sidebar">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-box">
                        <i class="fas fa-search search-icon"></i>
                        <input 
                            type="text" 
                            class="search-input" 
                            placeholder="Rechercher..." 
                            id="global-search"
                        />
                        <button class="search-clear" onclick="document.getElementById('global-search').value=''; document.getElementById('global-search').focus();">
                            <i class="fas fa-times"></i>
                        </button>
                        <div class="search-keyboard-hint">
                            <span class="kbd">Ctrl</span>
                            <span class="kbd">K</span>
                        </div>
                    </div>
                </div>
                <div class="header-right">
                    <div class="header-actions">
                        <!-- Dark Mode Toggle -->
                        <label class="theme-switch" aria-label="Toggle Dark Mode">
                            <input type="checkbox" id="dark-mode-toggle" onchange="toggleDarkMode()">
                            <span class="theme-slider">
                                <i class="fas fa-sun theme-icon theme-icon-sun"></i>
                                <i class="fas fa-moon theme-icon theme-icon-moon"></i>
                            </span>
                        </label>
                        
                        <!-- Notifications -->
                        <button class="header-btn" title="Notifications" aria-label="Notifications">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                        
                        <!-- Settings -->
                        <button class="header-btn" onclick="switchPage('settings')" title="Paramètres" aria-label="Settings">
                            <i class="fas fa-cog"></i>
                        </button>
                        
                        <!-- Logout -->
                        <button class="header-btn" onclick="handleLogout()" title="Déconnexion" aria-label="Logout">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Content Wrapper -->
            <div class="content-wrapper">
<div class="quick-stats-section animate-slide-up">
    <div class="quick-stats-grid">
        <!-- Serveurs Actifs -->
        <div class="stat-card animate-stagger-1">
            <div class="stat-card-header">
                <div class="stat-card-icon success">
                    <i class="fas fa-server"></i>
                </div>
                <div class="stat-card-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>12%</span>
                </div>
            </div>
            <div class="stat-card-body">
                <div class="stat-card-value" id="stat-servers-count">0</div>
                <div class="stat-card-label">Serveurs Actifs</div>
            </div>
            <div class="stat-card-footer">
                <i class="fas fa-clock"></i>
                <span>Mis à jour il y a <span id="stat-servers-updated">1 min</span></span>
            </div>
        </div>

        <!-- CPU Moyen -->
        <div class="stat-card animate-stagger-2">
            <div class="stat-card-header">
                <div class="stat-card-icon warning">
                    <i class="fas fa-microchip"></i>
                </div>
                <div class="stat-card-trend up">
                    <i class="fas fa-arrow-up"></i>
                    <span>5%</span>
                </div>
            </div>
            <div class="stat-card-body">
                <div class="stat-card-value" id="stat-cpu-avg">0%</div>
                <div class="stat-card-label">CPU Moyen</div>
            </div>
            <div class="stat-card-footer">
                <i class="fas fa-chart-line"></i>
                <span>Charge système normale</span>
            </div>
        </div>

        <!-- RAM Moyenne -->
        <div class="stat-card animate-stagger-3">
            <div class="stat-card-header">
                <div class="stat-card-icon info">
                    <i class="fas fa-memory"></i>
                </div>
                <div class="stat-card-trend down">
                    <i class="fas fa-arrow-down"></i>
                    <span>3%</span>
                </div>
            </div>
            <div class="stat-card-body">
                <div class="stat-card-value" id="stat-ram-avg">0%</div>
                <div class="stat-card-label">RAM Moyenne</div>
            </div>
            <div class="stat-card-footer">
                <i class="fas fa-check-circle"></i>
                <span>Mémoire optimale</span>
            </div>
        </div>

        <!-- Uptime Moyen -->
        <div class="stat-card animate-stagger-4">
            <div class="stat-card-header">
                <div class="stat-card-icon primary">
                    <i class="fas fa-clock"></i>
                </div>
                <div class="stat-card-trend up">
                    <i class="fas fa-check"></i>
                    <span>99.9%</span>
                </div>
            </div>
            <div class="stat-card-body">
                <div class="stat-card-value" id="stat-uptime-avg">0d</div>
                <div class="stat-card-label">Uptime Moyen</div>
            </div>
            <div class="stat-card-footer">
                <i class="fas fa-shield-alt"></i>
                <span>Stabilité excellente</span>
            </div>
        </div>
    </div>
</div>

                <!-- Chat AI Page -->
                <div id="page-chat" class="page-content">
                    <iframe 
                        id="iframe-chat" 
                        class="content-iframe" 
                        src="/ai-agent-chat.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Terminal SSH Page -->
                <div id="page-terminal" class="page-content hidden">
                    <iframe 
                        id="iframe-terminal" 
                        class="content-iframe" 
                        src="/terminal-ssh.html"
                        sandbox="allow-same-origin allow-scripts allow-forms"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Agent DevOps Page -->
                <div id="page-agent" class="page-content hidden">
                    <iframe 
                        id="iframe-agent" 
                        class="content-iframe" 
                        src="/agent-devops.html"
                        sandbox="allow-same-origin allow-scripts allow-forms"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Docker Page -->
                <div id="page-docker" class="page-content hidden">
                    <iframe 
                        id="iframe-docker" 
                        class="content-iframe" 
                        src="/docker-manager.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Monitoring Page -->
                <div id="page-monitoring" class="page-content hidden">
                    <iframe 
                        id="iframe-monitoring" 
                        class="content-iframe" 
                        src="/monitoring.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- CI/CD Page -->
                <div id="page-cicd" class="page-content hidden">
                    <iframe 
                        id="iframe-cicd" 
                        class="content-iframe" 
                        src="/cicd.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Code Analyzer Page -->
                <div id="page-code-analyzer" class="page-content hidden">
                    <iframe 
                        id="iframe-code-analyzer" 
                        class="content-iframe" 
                        src="/code-analyzer.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Sandbox Playground Page -->
                <div id="page-sandbox" class="page-content hidden">
                    <iframe 
                        id="iframe-sandbox" 
                        class="content-iframe" 
                        src="/sandbox-playground.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Live Monitoring Advanced Page -->
                <div id="page-monitoring-advanced" class="page-content hidden">
                    <iframe 
                        id="iframe-monitoring-advanced" 
                        class="content-iframe" 
                        src="/monitoring-advanced.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Admin Panel Page -->
                <div id="page-admin-panel" class="page-content hidden">
                    <iframe 
                        id="iframe-admin-panel" 
                        class="content-iframe" 
                        src="/admin-panel.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Subscription Manager Page -->
                <div id="page-subscription-manager" class="page-content hidden">
                    <iframe 
                        id="iframe-subscription-manager" 
                        class="content-iframe" 
                        src="/subscription-manager.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Autonomous Agent Page -->
                <div id="page-autonomous-agent" class="page-content hidden">
                    <iframe 
                        id="iframe-autonomous-agent" 
                        class="content-iframe" 
                        src="/autonomous-chat.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Projects Manager Page -->
                <div id="page-projects-manager" class="page-content hidden">
                    <iframe 
                        id="iframe-projects-manager" 
                        class="content-iframe" 
                        src="/projects-manager.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>

                <!-- Settings Page -->
                <!-- Enhancements Page -->
                <div id="page-enhancements" class="page-content hidden">
                    <iframe 
                        id="iframe-enhancements" 
                        class="content-iframe" 
                        src="/enhancements.html"
                        sandbox="allow-same-origin allow-scripts allow-forms allow-popups allow-modals"
                        allow="clipboard-read; clipboard-write">
                    </iframe>
                </div>


                <div id="page-settings" class="page-content hidden">
                    <div style="max-width: 1200px; margin: 0 auto;">
                        <h2 style="font-size: 2rem; font-weight: 700; margin-bottom: 2rem; background: var(--primary-gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                            <i class="fas fa-cog"></i> Paramètres
                        </h2>
                        
                        <div style="display: grid; gap: 1.5rem;">
                            <!-- System Info Card -->
                            <div style="background: var(--light-card); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);">
                                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--text-dark);">
                                    <i class="fas fa-info-circle" style="color: var(--info-color);"></i> Informations Système
                                </h3>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 1.5rem;">
                                    <div style="padding: 1rem; background: var(--light-bg); border-radius: 12px;">
                                        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem;">Version</div>
                                        <div style="font-weight: 600; font-size: 1.1rem;">2.0.0 Professional</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--light-bg); border-radius: 12px;">
                                        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem;">Backend</div>
                                        <div style="font-weight: 600; font-size: 1.1rem;">Node.js + Express</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--light-bg); border-radius: 12px;">
                                        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem;">Base de données</div>
                                        <div style="font-weight: 600; font-size: 1.1rem;">SQLite</div>
                                    </div>
                                    <div style="padding: 1rem; background: var(--light-bg); border-radius: 12px;">
                                        <div style="color: var(--text-muted); font-size: 0.85rem; margin-bottom: 0.5rem;">AI Model</div>
                                        <div style="font-weight: 600; font-size: 1.1rem;">GPT-4</div>
                                    </div>
                                </div>
                            </div>

                            <!-- Quick Access Card -->
                            <div style="background: var(--light-card); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);">
                                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--text-dark);">
                                    <i class="fas fa-link" style="color: var(--primary-color);"></i> Accès Rapide
                                </h3>
                                <p style="color: var(--text-muted); margin-bottom: 1.5rem;">
                                    Ouvrez directement une page dans un nouvel onglet.
                                </p>
                                <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                    <a href="/ai-agent-chat.html" target="_blank" style="padding: 0.75rem 1.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-color); text-decoration: none; border-radius: 12px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <i class="fas fa-comments"></i> Chat AI
                                    </a>
                                    <a href="/terminal-ssh.html" target="_blank" style="padding: 0.75rem 1.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-color); text-decoration: none; border-radius: 12px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <i class="fas fa-terminal"></i> Terminal SSH
                                    </a>
                                    <a href="/agent-devops.html" target="_blank" style="padding: 0.75rem 1.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-color); text-decoration: none; border-radius: 12px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <i class="fas fa-robot"></i> Agent DevOps
                                    </a>
                                    <a href="/docker-manager.html" target="_blank" style="padding: 0.75rem 1.5rem; background: rgba(102, 126, 234, 0.1); color: var(--primary-color); text-decoration: none; border-radius: 12px; font-weight: 600; transition: all 0.3s; display: inline-flex; align-items: center; gap: 0.5rem;">
                                        <i class="fab fa-docker"></i> Docker Manager
                                    </a>
                                </div>
                            </div>

                            <!-- Documentation Card -->
                            <div style="background: var(--light-card); padding: 2rem; border-radius: 16px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);">
                                <h3 style="font-size: 1.25rem; font-weight: 600; margin-bottom: 1.5rem; color: var(--text-dark);">
                                    <i class="fas fa-book" style="color: var(--success-color);"></i> Documentation
                                </h3>
                                <div style="display: grid; gap: 1rem;">
                                    <a href="/API-ENHANCEMENTS-DOCUMENTATION.md" target="_blank" style="padding: 1rem; background: var(--light-bg); border-radius: 12px; text-decoration: none; color: var(--text-dark); display: flex; align-items: center; gap: 1rem; transition: all 0.3s;">
                                        <i class="fas fa-file-code" style="font-size: 1.5rem; color: var(--primary-color);"></i>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">API Enhancements</div>
                                            <div style="font-size: 0.85rem; color: var(--text-muted);">Documentation complète des nouvelles API</div>
                                        </div>
                                    </a>
                                    <a href="/RAPPORT-TESTS-FINAL.md" target="_blank" style="padding: 1rem; background: var(--light-bg); border-radius: 12px; text-decoration: none; color: var(--text-dark); display: flex; align-items: center; gap: 1rem; transition: all 0.3s;">
                                        <i class="fas fa-check-circle" style="font-size: 1.5rem; color: var(--success-color);"></i>
                                        <div>
                                            <div style="font-weight: 600; margin-bottom: 0.25rem;">Rapport de Tests</div>
                                            <div style="font-size: 0.85rem; color: var(--text-muted);">Résultats des tests complets (12/12 réussis)</div>
                                        </div>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
// 🔧 Propagation des événements vers les iframes        window.addEventListener('serverContextChanged', function(event) {            console.log('📡 Dashboard received serverContextChanged:', event.detail);                        // Propager vers tous les iframes            const iframes = document.querySelectorAll('iframe');            iframes.forEach(function(iframe) {                try {                    if (iframe.contentWindow) {                        iframe.contentWindow.postMessage({                            type: 'serverContextChanged',                            detail: event.detail                        }, '*');                        console.log('📤 Event forwarded to iframe:', iframe.id);                    }                } catch (e) {                    console.error('❌ Failed to forward event to iframe:', e);                }            });        });
        // ===== GLOBALS =====
        const API_BASE = window.location.origin + '/api';
        let currentUser = null;
        let isSidebarCollapsed = false;
        let currentPage = 'chat';

        // ===== INITIALIZATION =====
        document.addEventListener('DOMContentLoaded', async () => {
            console.log('🚀 Professional Dashboard initializing...');
            
            // Check auth
            const token = localStorage.getItem('authToken');
            if (!token) {
                window.location.href = '/';
                return;
            }

            // Load user info
            await loadUserInfo();

            // Setup iframes
            setupIframes();

            // Load dark mode preference
            loadDarkModePreference();
            initializePhase1Enhancements();
            initializePhase2Enhancements();
            initializePhase3Enhancements();

            // Setup global search
            setupGlobalSearch();

            console.log('✅ Professional Dashboard initialized');
        });

        // ===== USER INFO =====
        async function loadUserInfo() {
            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                const payload = JSON.parse(atob(token.split('.')[1]));
                currentUser = payload;
                
                const username = payload.username || 'Admin';
                document.getElementById('user-name').textContent = username;
                document.getElementById('user-avatar').textContent = username.charAt(0).toUpperCase();

                console.log('✅ User loaded:', username);
            } catch (error) {
                console.error('❌ Error loading user:', error);
            }
        }

        // ===== SIDEBAR =====
        window.toggleSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            isSidebarCollapsed = !isSidebarCollapsed;
            
            if (window.innerWidth <= 768) {
                // Mobile: slide in/out
                window.toggleMobileSidebar();
            } else {
                // Desktop: collapse/expand
                sidebar.classList.toggle('collapsed');
            }
        }

        window.toggleMobileSidebar = function() {
            const sidebar = document.getElementById('sidebar');
            const overlay = document.getElementById('mobile-overlay');
            
            sidebar.classList.toggle('mobile-open');
            overlay.classList.toggle('active');
        }

        // ===== PAGE NAVIGATION =====
        window.switchPage = function(pageName) {
            console.log(`🔄 Switching to: ${pageName}`);
            
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });

            // Remove active from all nav items
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            // Show selected page
            const pageElement = document.getElementById(`page-${pageName}`);
            if (pageElement) {
                pageElement.classList.remove('hidden');
            }

            // Add active to selected nav item
            const navItem = document.querySelector(`[data-page="${pageName}"]`);
            if (navItem) {
                navItem.classList.add('active');
            }

            // Close mobile menu
            if (window.innerWidth <= 768) {
                toggleMobileSidebar();
            }

            // Send token to iframe
            setTimeout(() => {
                if (pageName !== 'settings') {
                    sendTokenToIframe(pageName);
                }
            }, 100);

            currentPage = pageName;
        }

        // ===== IFRAME MANAGEMENT =====
        function setupIframes() {
            const iframes = ['iframe-chat', 'iframe-terminal', 'iframe-agent', 'iframe-docker', 'iframe-monitoring', 'iframe-cicd'];
            
            iframes.forEach(iframeId => {
                const iframe = document.getElementById(iframeId);
                if (!iframe) return;
                
                iframe.addEventListener('load', () => {
                    console.log(`✅ Iframe loaded: ${iframeId}`);
                    sendTokenToIframe(iframeId.replace('iframe-', ''));
                });
            });

            // Listen to iframe messages
            window.addEventListener('message', handleIframeMessage);
        }

        function sendTokenToIframe(pageName) {
            const iframe = document.getElementById(`iframe-${pageName}`);
            if (!iframe || !iframe.contentWindow) return;

            const token = localStorage.getItem('authToken');
            if (!token) return;

            try {
                iframe.contentWindow.postMessage({
                    type: 'AUTH_TOKEN',
                    token: token
                }, window.location.origin);
                console.log(`📤 Token sent to ${pageName}`);
            } catch (error) {
                console.error(`❌ Error sending token to ${pageName}:`, error);
            }
        }

        function handleIframeMessage(event) {
            if (event.origin !== window.location.origin) return;

            const { type, data } = event.data;

            switch (type) {
                case 'IFRAME_READY':
                    console.log('📩 Iframe ready');
                    const token = localStorage.getItem('authToken');
                    if (token) {
                        event.source.postMessage({
                            type: 'AUTH_TOKEN',
                            token: token
                        }, event.origin);
                    }
                    break;

                case 'LOGOUT_REQUEST':
                    console.log('📩 Logout request from iframe');
                    handleLogout();
                    break;

                case 'ERROR':
                    console.error('📩 Error from iframe:', data);
                    break;
            }
        }

        // ===== DARK MODE =====
        window.toggleDarkMode = function() { enhancedToggleDarkMode(); }
        }

        function loadDarkModePreference() {
            const darkMode = localStorage.getItem('darkMode');
            const toggle = document.getElementById('dark-mode-toggle');
            
            if (darkMode === 'enabled') {
                document.body.classList.add('dark-mode');
                toggle.checked = true;
            }
        }

        // ===== GLOBAL SEARCH =====
        function setupGlobalSearch() {
            const searchInput = document.getElementById('global-search');
            if (!searchInput) return;

            searchInput.addEventListener('input', (e) => {
                const query = e.target.value.toLowerCase();
                console.log('🔍 Search:', query);
                
                // TODO: Implement search functionality
                // Could search through nav items, recent actions, etc.
            });
        }

        // ===== LOGOUT =====
        window.handleLogout = function() {
            console.log('🚪 Logging out...');
            
            localStorage.removeItem('authToken');
            
            // Notify iframes
            document.querySelectorAll('.content-iframe').forEach(iframe => {
                if (iframe.contentWindow) {
                    try {
                        iframe.contentWindow.postMessage({
                            type: 'LOGOUT'
                        }, window.location.origin);
                    } catch (error) {
                        console.error('Error notifying iframe:', error);
                    }
                }
            });

            setTimeout(() => {
                window.location.href = '/';
            }, 300);
        }

        // ===== LOADING =====
        function showLoading() {
            document.getElementById('loading-overlay').classList.remove('hidden');
        }

        function hideLoading() {
            document.getElementById('loading-overlay').classList.add('hidden');
        }

        // ===== RESPONSIVE =====
        window.addEventListener('resize', () => {
            const sidebar = document.getElementById('sidebar');
            if (window.innerWidth > 768) {
                sidebar.classList.remove('mobile-open');
                document.getElementById('mobile-overlay').classList.remove('active');
            }
        });

        // ===== ERROR HANDLING =====
        window.addEventListener('error', (event) => {
            console.error('❌ Global error:', event.error);
        });

        window.addEventListener('unhandledrejection', (event) => {
            console.error('❌ Unhandled rejection:', event.reason);
        });
    </script>
<script src="/ai-assistant.js">

// ===== PHASE 1 ENHANCEMENTS =====
// ===== QUICK STATS MANAGEMENT =====
class QuickStatsManager {
    constructor() {
        this.updateInterval = null;
        this.animationFrameId = null;
    }

    async fetchStats() {
        try {
            const token = localStorage.getItem('authToken');
            if (!token) return null;

            const response = await fetch('/api/servers', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });

            if (!response.ok) throw new Error('Failed to fetch stats');

            const data = await response.json();
            return this.calculateStats(data.servers || []);
        } catch (error) {
            console.error('❌ Error fetching quick stats:', error);
            return null;
        }
    }

    calculateStats(servers) {
        if (!servers.length) {
            return {
                serversCount: 0,
                cpuAvg: 0,
                ramAvg: 0,
                uptimeAvg: 0
            };
        }

        const activeServers = servers.filter(s => s.status === 'active' || s.status === 'online');
        const cpuSum = servers.reduce((sum, s) => sum + (s.cpu_usage || 0), 0);
        const ramSum = servers.reduce((sum, s) => sum + (s.memory_usage || 0), 0);
        const uptimeSum = servers.reduce((sum, s) => sum + (s.uptime || 0), 0);

        return {
            serversCount: activeServers.length,
            cpuAvg: servers.length ? Math.round(cpuSum / servers.length) : 0,
            ramAvg: servers.length ? Math.round(ramSum / servers.length) : 0,
            uptimeAvg: servers.length ? Math.round(uptimeSum / servers.length / 86400) : 0 // Convert to days
        };
    }

    animateValue(element, start, end, duration = 1000) {
        const startTime = performance.now();
        const suffix = element.textContent.replace(/[0-9.]/g, '').trim();

        const animate = (currentTime) => {
            const elapsed = currentTime - startTime;
            const progress = Math.min(elapsed / duration, 1);
            
            // Easing function (ease-out-cubic)
            const easeOut = 1 - Math.pow(1 - progress, 3);
            const current = Math.round(start + (end - start) * easeOut);
            
            element.textContent = current + suffix;

            if (progress < 1) {
                this.animationFrameId = requestAnimationFrame(animate);
            }
        };

        requestAnimationFrame(animate);
    }

    updateDisplay(stats) {
        if (!stats) return;

        // Animate servers count
        const serversEl = document.getElementById('stat-servers-count');
        if (serversEl) {
            const currentValue = parseInt(serversEl.textContent) || 0;
            this.animateValue(serversEl, currentValue, stats.serversCount);
        }

        // Animate CPU
        const cpuEl = document.getElementById('stat-cpu-avg');
        if (cpuEl) {
            const currentValue = parseInt(cpuEl.textContent) || 0;
            cpuEl.textContent = `${stats.cpuAvg}%`;
        }

        // Animate RAM
        const ramEl = document.getElementById('stat-ram-avg');
        if (ramEl) {
            const currentValue = parseInt(ramEl.textContent) || 0;
            ramEl.textContent = `${stats.ramAvg}%`;
        }

        // Animate Uptime
        const uptimeEl = document.getElementById('stat-uptime-avg');
        if (uptimeEl) {
            const currentValue = parseInt(uptimeEl.textContent) || 0;
            uptimeEl.textContent = `${stats.uptimeAvg}d`;
        }

        // Update timestamp
        const updatedEl = document.getElementById('stat-servers-updated');
        if (updatedEl) {
            updatedEl.textContent = '1 min';
        }
    }

    async refresh() {
        const stats = await this.fetchStats();
        if (stats) {
            this.updateDisplay(stats);
        }
    }

    start() {
        // Initial load
        this.refresh();

        // Auto-refresh every 30 seconds
        this.updateInterval = setInterval(() => {
            this.refresh();
        }, 30000);

        console.log('✅ Quick Stats Manager started');
    }

    stop() {
        if (this.updateInterval) {
            clearInterval(this.updateInterval);
            this.updateInterval = null;
        }
        if (this.animationFrameId) {
            cancelAnimationFrame(this.animationFrameId);
            this.animationFrameId = null;
        }
        console.log('⏹ Quick Stats Manager stopped');
    }
}

// Initialize Quick Stats Manager
const quickStatsManager = new QuickStatsManager();

// ===== ENHANCED DARK MODE WITH SMOOTH TRANSITION =====
function enhancedToggleDarkMode() {
    // Add transition class
    document.body.style.transition = 'background-color 0.3s ease, color 0.3s ease';
    
    const isDark = document.body.classList.toggle('dark-mode');
    localStorage.setItem('darkMode', isDark ? 'enabled' : 'disabled');
    
    // Add ripple effect on toggle
    const toggle = document.getElementById('dark-mode-toggle');
    if (toggle) {
        toggle.parentElement.style.transform = 'scale(0.95)';
        setTimeout(() => {
            toggle.parentElement.style.transform = 'scale(1)';
        }, 150);
    }

    console.log(`🌓 Dark mode: ${isDark ? 'ON' : 'OFF'}`);
    
    // Remove transition after change to avoid lag
    setTimeout(() => {
        document.body.style.transition = '';
    }, 300);
}

// ===== INTERSECTION OBSERVER FOR ANIMATIONS =====
function setupScrollAnimations() {
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.classList.add('animate-fade-in');
                observer.unobserve(entry.target);
            }
        });
    }, {
        threshold: 0.1,
        rootMargin: '0px 0px -100px 0px'
    });

    // Observe stat cards
    document.querySelectorAll('.stat-card').forEach(card => {
        observer.observe(card);
    });
}

// ===== KEYBOARD SHORTCUTS =====
function setupKeyboardShortcuts() {
    document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + K : Focus search
        if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
            e.preventDefault();
            const searchInput = document.getElementById('global-search');
            if (searchInput) {
                searchInput.focus();
            }
        }

        // Ctrl/Cmd + D : Toggle dark mode
        if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
            e.preventDefault();
            enhancedToggleDarkMode();
        }

        // Esc : Clear search
        if (e.key === 'Escape') {
            const searchInput = document.getElementById('global-search');
            if (searchInput && searchInput.value) {
                searchInput.value = '';
                searchInput.blur();
            }
        }
    });

    console.log('⌨️ Keyboard shortcuts enabled (Ctrl+K: Search, Ctrl+D: Dark mode)');
}

// ===== PERFORMANCE MONITORING =====
function logPerformanceMetrics() {
    if (window.performance && window.performance.timing) {
        const perfData = window.performance.timing;
        const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
        const connectTime = perfData.responseEnd - perfData.requestStart;
        const renderTime = perfData.domComplete - perfData.domLoading;

        console.log('📊 Performance Metrics:', {
            pageLoad: `${pageLoadTime}ms`,
            connect: `${connectTime}ms`,
            render: `${renderTime}ms`
        });
    }
}

// ===== INITIALIZE PHASE 1 ENHANCEMENTS =====
function initializePhase1Enhancements() {
    console.log('🚀 Initializing Phase 1 Enhancements...');
    
    // Start Quick Stats Manager
    quickStatsManager.start();
    
    // Setup scroll animations
    setupScrollAnimations();
    
    // Setup keyboard shortcuts
    setupKeyboardShortcuts();
    
    // Log performance
    setTimeout(logPerformanceMetrics, 1000);
    
    console.log('✅ Phase 1 Enhancements loaded successfully!');
}



// ===== PHASE 2 ENHANCEMENTS =====
// ===== GLOBAL SEARCH MANAGER =====
class GlobalSearchManager {
    constructor() {
        this.searchInput = document.getElementById('global-search');
        this.searchResults = null;
        this.selectedIndex = -1;
        this.searchData = [];
        
        this.init();
    }
    
    init() {
        if (!this.searchInput) return;
        
        // Create search results container
        this.createSearchResults();
        
        // Build search index
        this.buildSearchIndex();
        
        // Setup event listeners
        this.searchInput.addEventListener('input', (e) => this.handleSearch(e.target.value));
        this.searchInput.addEventListener('focus', () => this.showRecentSearches());
        this.searchInput.addEventListener('keydown', (e) => this.handleKeyDown(e));
        
        // Click outside to close
        document.addEventListener('click', (e) => {
            if (!e.target.closest('.search-box')) {
                this.hideResults();
            }
        });
        
        console.log('✅ Global Search Manager initialized');
    }
    
    createSearchResults() {
        const resultsHTML = `
            <div class="search-results" id="search-results">
                <div class="search-results-content"></div>
            </div>
        `;
        
        const searchBox = this.searchInput.closest('.search-box');
        searchBox.insertAdjacentHTML('beforeend', resultsHTML);
        this.searchResults = document.getElementById('search-results');
    }
    
    buildSearchIndex() {
        // Pages
        const pages = [
            { type: 'page', icon: 'fa-comments', title: 'Chat AI', desc: 'Assistant conversationnel intelligent', page: 'chat', keywords: ['ai', 'chat', 'assistant', 'conversation'] },
            { type: 'page', icon: 'fa-terminal', title: 'Terminal SSH', desc: 'Accès terminal aux serveurs', page: 'terminal', keywords: ['ssh', 'terminal', 'console', 'shell'] },
            { type: 'page', icon: 'fa-robot', title: 'Agent DevOps', desc: 'Gestion automatisée des serveurs', page: 'agent', keywords: ['agent', 'devops', 'automation'] },
            { type: 'page', icon: 'fa-docker', title: 'Docker Manager', desc: 'Gestion des conteneurs Docker', page: 'docker', keywords: ['docker', 'container', 'conteneur'] },
            { type: 'page', icon: 'fa-chart-bar', title: 'Monitoring', desc: 'Surveillance système en temps réel', page: 'monitoring', keywords: ['monitoring', 'surveillance', 'metrics'] },
            { type: 'page', icon: 'fa-rocket', title: 'CI/CD', desc: 'Pipelines de déploiement', page: 'cicd', keywords: ['cicd', 'deploy', 'pipeline'] },
            { type: 'page', icon: 'fa-code', title: 'Code Analyzer', desc: 'Analyse de code source', page: 'code-analyzer', keywords: ['code', 'analyzer', 'analyse'] },
            { type: 'page', icon: 'fa-play', title: 'Sandbox Playground', desc: 'Environnement d\'exécution de code', page: 'sandbox', keywords: ['sandbox', 'playground', 'test'] },
            { type: 'page', icon: 'fa-chart-line', title: 'Live Monitoring Pro', desc: 'Monitoring avancé avec graphiques', page: 'monitoring-advanced', keywords: ['monitoring', 'live', 'graphs'] },
            { type: 'page', icon: 'fa-cog', title: 'Paramètres', desc: 'Configuration du dashboard', page: 'settings', keywords: ['settings', 'config', 'parametres'] }
        ];
        
        // Actions
        const actions = [
            { type: 'action', icon: 'fa-moon', title: 'Toggle Dark Mode', desc: 'Basculer le thème sombre', action: 'toggleDarkMode', shortcut: 'Ctrl+D' },
            { type: 'action', icon: 'fa-search', title: 'Focus Search', desc: 'Activer la recherche', action: 'focusSearch', shortcut: 'Ctrl+K' },
            { type: 'action', icon: 'fa-keyboard', title: 'Keyboard Shortcuts', desc: 'Afficher les raccourcis', action: 'showShortcuts', shortcut: 'Ctrl+?' },
            { type: 'action', icon: 'fa-sign-out-alt', title: 'Déconnexion', desc: 'Se déconnecter du dashboard', action: 'logout', shortcut: '' }
        ];
        
        this.searchData = [...pages, ...actions];
    }
    
    handleSearch(query) {
        if (!query.trim()) {
            this.hideResults();
            return;
        }
        
        const normalizedQuery = query.toLowerCase().trim();
        const results = this.searchData.filter(item => {
            const searchText = `${item.title} ${item.desc} ${item.keywords ? item.keywords.join(' ') : ''}`.toLowerCase();
            return searchText.includes(normalizedQuery);
        });
        
        this.displayResults(results, query);
        this.selectedIndex = -1;
    }
    
    displayResults(results, query) {
        const content = this.searchResults.querySelector('.search-results-content');
        
        if (results.length === 0) {
            content.innerHTML = `
                <div class="search-no-results">
                    <i class="fas fa-search" style="font-size: 2rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                    <p>Aucun résultat pour "<strong>${query}</strong>"</p>
                </div>
            `;
        } else {
            const header = `<div class="search-results-header">${results.length} résultat${results.length > 1 ? 's' : ''}</div>`;
            const items = results.map((item, index) => `
                <div class="search-result-item" data-index="${index}" data-type="${item.type}" data-target="${item.page || item.action}">
                    <div class="search-result-icon ${item.type}">
                        <i class="fas ${item.icon}"></i>
                    </div>
                    <div class="search-result-content">
                        <div class="search-result-title">${this.highlightQuery(item.title, query)}</div>
                        <div class="search-result-desc">${item.desc}</div>
                    </div>
                    ${item.shortcut ? `<div class="search-result-badge">${item.shortcut}</div>` : ''}
                </div>
            `).join('');
            
            content.innerHTML = header + items;
            
            // Add click handlers
            content.querySelectorAll('.search-result-item').forEach(item => {
                item.addEventListener('click', () => this.selectResult(item));
            });
        }
        
        this.searchResults.classList.add('active');
    }
    
    highlightQuery(text, query) {
        const regex = new RegExp(`(${query})`, 'gi');
        return text.replace(regex, '<strong style="color: var(--primary-color);">$1</strong>');
    }
    
    hideResults() {
        if (this.searchResults) {
            this.searchResults.classList.remove('active');
        }
    }
    
    showRecentSearches() {
        // TODO: Implement recent searches from localStorage
    }
    
    handleKeyDown(e) {
        if (!this.searchResults.classList.contains('active')) return;
        
        const items = this.searchResults.querySelectorAll('.search-result-item');
        
        if (e.key === 'ArrowDown') {
            e.preventDefault();
            this.selectedIndex = Math.min(this.selectedIndex + 1, items.length - 1);
            this.updateSelection(items);
        } else if (e.key === 'ArrowUp') {
            e.preventDefault();
            this.selectedIndex = Math.max(this.selectedIndex - 1, -1);
            this.updateSelection(items);
        } else if (e.key === 'Enter') {
            e.preventDefault();
            if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
                this.selectResult(items[this.selectedIndex]);
            }
        } else if (e.key === 'Escape') {
            this.hideResults();
            this.searchInput.blur();
        }
    }
    
    updateSelection(items) {
        items.forEach((item, index) => {
            item.classList.toggle('selected', index === this.selectedIndex);
        });
        
        if (this.selectedIndex >= 0 && items[this.selectedIndex]) {
            items[this.selectedIndex].scrollIntoView({ block: 'nearest' });
        }
    }
    
    selectResult(item) {
        const type = item.dataset.type;
        const target = item.dataset.target;
        
        if (type === 'page') {
            switchPage(target);
        } else if (type === 'action') {
            this.executeAction(target);
        }
        
        this.searchInput.value = '';
        this.hideResults();
        this.searchInput.blur();
    }
    
    executeAction(action) {
        switch(action) {
            case 'toggleDarkMode':
                enhancedToggleDarkMode();
                break;
            case 'focusSearch':
                this.searchInput.focus();
                break;
            case 'showShortcuts':
                showKeyboardShortcuts();
                break;
            case 'logout':
                handleLogout();
                break;
        }
    }
}

// ===== BREADCRUMBS MANAGER =====
class BreadcrumbsManager {
    constructor() {
        this.container = null;
        this.currentPath = ['Dashboard'];
        
        this.init();
    }
    
    init() {
        this.createBreadcrumbs();
        console.log('✅ Breadcrumbs Manager initialized');
    }
    
    createBreadcrumbs() {
        const header = document.querySelector('.header');
        if (!header) return;
        
        const breadcrumbsHTML = `
            <div class="breadcrumbs" id="breadcrumbs-nav">
                <a href="#" class="breadcrumb-item" onclick="switchPage('chat'); return false;">
                    <i class="fas fa-home breadcrumb-icon"></i>
                    <span>Dashboard</span>
                </a>
            </div>
        `;
        
        header.insertAdjacentHTML('afterend', breadcrumbsHTML);
        this.container = document.getElementById('breadcrumbs-nav');
    }
    
    update(pageName) {
        if (!this.container) return;
        
        const pageInfo = this.getPageInfo(pageName);
        
        const breadcrumbsHTML = `
            <a href="#" class="breadcrumb-item" onclick="switchPage('chat'); return false;">
                <i class="fas fa-home breadcrumb-icon"></i>
                <span>Dashboard</span>
            </a>
            <span class="breadcrumb-separator"><i class="fas fa-chevron-right"></i></span>
            <span class="breadcrumb-item active">
                <i class="fas ${pageInfo.icon} breadcrumb-icon"></i>
                <span>${pageInfo.title}</span>
            </span>
        `;
        
        this.container.innerHTML = breadcrumbsHTML;
    }
    
    getPageInfo(pageName) {
        const pages = {
            'chat': { title: 'Chat AI', icon: 'fa-comments' },
            'terminal': { title: 'Terminal SSH', icon: 'fa-terminal' },
            'agent': { title: 'Agent DevOps', icon: 'fa-robot' },
            'docker': { title: 'Docker Manager', icon: 'fa-docker' },
            'monitoring': { title: 'Monitoring', icon: 'fa-chart-bar' },
            'cicd': { title: 'CI/CD', icon: 'fa-rocket' },
            'code-analyzer': { title: 'Code Analyzer', icon: 'fa-code' },
            'sandbox': { title: 'Sandbox', icon: 'fa-play' },
            'monitoring-advanced': { title: 'Live Monitoring', icon: 'fa-chart-line' },
            'settings': { title: 'Paramètres', icon: 'fa-cog' }
        };
        
        return pages[pageName] || { title: pageName, icon: 'fa-file' };
    }
}

// ===== CONTEXT MENU MANAGER =====
class ContextMenuManager {
    constructor() {
        this.menu = null;
        this.init();
    }
    
    init() {
        this.createContextMenu();
        this.setupEventListeners();
        console.log('✅ Context Menu Manager initialized');
    }
    
    createContextMenu() {
        const menuHTML = `
            <div class="context-menu" id="context-menu">
                <div class="context-menu-item" data-action="refresh">
                    <i class="fas fa-sync-alt context-menu-icon"></i>
                    <span class="context-menu-label">Rafraîchir</span>
                    <span class="context-menu-shortcut">F5</span>
                </div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" data-action="toggleDark">
                    <i class="fas fa-moon context-menu-icon"></i>
                    <span class="context-menu-label">Mode Sombre</span>
                    <span class="context-menu-shortcut">Ctrl+D</span>
                </div>
                <div class="context-menu-item" data-action="shortcuts">
                    <i class="fas fa-keyboard context-menu-icon"></i>
                    <span class="context-menu-label">Raccourcis</span>
                    <span class="context-menu-shortcut">Ctrl+?</span>
                </div>
                <div class="context-menu-separator"></div>
                <div class="context-menu-item" data-action="settings">
                    <i class="fas fa-cog context-menu-icon"></i>
                    <span class="context-menu-label">Paramètres</span>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', menuHTML);
        this.menu = document.getElementById('context-menu');
        
        // Add click handlers
        this.menu.querySelectorAll('.context-menu-item').forEach(item => {
            item.addEventListener('click', () => {
                this.executeAction(item.dataset.action);
                this.hide();
            });
        });
    }
    
    setupEventListeners() {
        // Right-click on main content
        document.addEventListener('contextmenu', (e) => {
            // Only show on main content, not on iframes
            if (e.target.closest('.content-iframe')) return;
            
            e.preventDefault();
            this.show(e.pageX, e.pageY);
        });
        
        // Click outside to close
        document.addEventListener('click', () => this.hide());
        
        // Escape to close
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') this.hide();
        });
    }
    
    show(x, y) {
        this.menu.classList.add('active');
        
        // Position menu
        this.menu.style.left = `${x}px`;
        this.menu.style.top = `${y}px`;
        
        // Adjust if off-screen
        const rect = this.menu.getBoundingClientRect();
        if (rect.right > window.innerWidth) {
            this.menu.style.left = `${x - rect.width}px`;
        }
        if (rect.bottom > window.innerHeight) {
            this.menu.style.top = `${y - rect.height}px`;
        }
    }
    
    hide() {
        if (this.menu) {
            this.menu.classList.remove('active');
        }
    }
    
    executeAction(action) {
        switch(action) {
            case 'refresh':
                location.reload();
                break;
            case 'toggleDark':
                enhancedToggleDarkMode();
                break;
            case 'shortcuts':
                showKeyboardShortcuts();
                break;
            case 'settings':
                switchPage('settings');
                break;
        }
    }
}

// ===== KEYBOARD SHORTCUTS MANAGER =====
class KeyboardShortcutsManager {
    constructor() {
        this.modal = null;
        this.shortcuts = {
            'navigation': [
                { keys: ['Ctrl', '1-9'], desc: 'Aller à la page N' },
                { keys: ['Ctrl', 'K'], desc: 'Focus recherche' },
                { keys: ['Esc'], desc: 'Fermer/Annuler' }
            ],
            'actions': [
                { keys: ['Ctrl', 'D'], desc: 'Toggle Dark Mode' },
                { keys: ['Ctrl', '?'], desc: 'Afficher ce guide' },
                { keys: ['F5'], desc: 'Rafraîchir la page' }
            ],
            'editing': [
                { keys: ['Ctrl', 'S'], desc: 'Sauvegarder (si applicable)' },
                { keys: ['Ctrl', 'Z'], desc: 'Annuler' },
                { keys: ['Ctrl', 'Y'], desc: 'Refaire' }
            ]
        };
        
        this.init();
    }
    
    init() {
        this.createModal();
        this.setupGlobalShortcuts();
        console.log('✅ Keyboard Shortcuts Manager initialized');
    }
    
    createModal() {
        const modalHTML = `
            <div class="shortcuts-modal" id="shortcuts-modal">
                <div class="shortcuts-modal-content">
                    <div class="shortcuts-modal-header">
                        <div class="shortcuts-modal-title">⌨️ Raccourcis Clavier</div>
                        <div class="shortcuts-modal-subtitle">Naviguez plus rapidement avec ces raccourcis</div>
                    </div>
                    <div class="shortcuts-modal-body">
                        ${this.renderShortcuts()}
                    </div>
                    <div class="shortcuts-modal-footer">
                        <button class="shortcuts-close-btn" onclick="hideKeyboardShortcuts()">
                            Fermer
                        </button>
                    </div>
                </div>
            </div>
        `;
        
        document.body.insertAdjacentHTML('beforeend', modalHTML);
        this.modal = document.getElementById('shortcuts-modal');
        
        // Close on background click
        this.modal.addEventListener('click', (e) => {
            if (e.target === this.modal) {
                this.hide();
            }
        });
    }
    
    renderShortcuts() {
        let html = '';
        
        const sectionTitles = {
            'navigation': '🧭 Navigation',
            'actions': '⚡ Actions',
            'editing': '✏️ Édition'
        };
        
        for (const [section, shortcuts] of Object.entries(this.shortcuts)) {
            html += `
                <div class="shortcuts-section">
                    <div class="shortcuts-section-title">${sectionTitles[section]}</div>
            `;
            
            shortcuts.forEach(shortcut => {
                html += `
                    <div class="shortcut-item">
                        <span class="shortcut-desc">${shortcut.desc}</span>
                        <div class="shortcut-keys">
                            ${shortcut.keys.map(key => `<span class="kbd">${key}</span>`).join(' + ')}
                        </div>
                    </div>
                `;
            });
            
            html += `</div>`;
        }
        
        return html;
    }
    
    setupGlobalShortcuts() {
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + ? : Show shortcuts
            if ((e.ctrlKey || e.metaKey) && e.key === '?') {
                e.preventDefault();
                this.show();
            }
            
            // Ctrl/Cmd + 1-9 : Navigate to page
            if ((e.ctrlKey || e.metaKey) && e.key >= '1' && e.key <= '9') {
                e.preventDefault();
                const pageIndex = parseInt(e.key) - 1;
                this.navigateToPageByIndex(pageIndex);
            }
        });
    }
    
    navigateToPageByIndex(index) {
        const pages = ['chat', 'terminal', 'agent', 'docker', 'monitoring', 'cicd', 'code-analyzer', 'sandbox', 'monitoring-advanced'];
        if (index < pages.length) {
            switchPage(pages[index]);
        }
    }
    
    show() {
        this.modal.classList.add('active');
    }
    
    hide() {
        this.modal.classList.remove('active');
    }
}

// ===== MOBILE TOUCH GESTURES =====
class MobileTouchManager {
    constructor() {
        this.touchStartX = 0;
        this.touchEndX = 0;
        this.swipeThreshold = 100;
        
        this.init();
    }
    
    init() {
        if (window.innerWidth > 768) return; // Desktop only
        
        document.addEventListener('touchstart', (e) => {
            this.touchStartX = e.changedTouches[0].screenX;
        });
        
        document.addEventListener('touchend', (e) => {
            this.touchEndX = e.changedTouches[0].screenX;
            this.handleSwipe();
        });
        
        console.log('✅ Mobile Touch Manager initialized');
    }
    
    handleSwipe() {
        const swipeDistance = this.touchEndX - this.touchStartX;
        
        // Swipe right (open sidebar)
        if (swipeDistance > this.swipeThreshold) {
            const sidebar = document.getElementById('sidebar');
            if (sidebar && !sidebar.classList.contains('mobile-open')) {
                toggleMobileSidebar();
            }
        }
        
        // Swipe left (close sidebar)
        if (swipeDistance < -this.swipeThreshold) {
            const sidebar = document.getElementById('sidebar');
            if (sidebar && sidebar.classList.contains('mobile-open')) {
                toggleMobileSidebar();
            }
        }
    }
}

// ===== GLOBAL FUNCTIONS =====
function showKeyboardShortcuts() {
    const modal = document.getElementById('shortcuts-modal');
    if (modal) modal.classList.add('active');
}

window.hideKeyboardShortcuts = function() {
    const modal = document.getElementById('shortcuts-modal');
    if (modal) modal.classList.remove('active');
}

// ===== INITIALIZE PHASE 2 ENHANCEMENTS =====
let globalSearchManager;
let breadcrumbsManager;
let contextMenuManager;
let keyboardShortcutsManager;
let mobileTouchManager;

function initializePhase2Enhancements() {
    console.log('🚀 Initializing Phase 2 Enhancements...');
    
    // Initialize managers
    globalSearchManager = new GlobalSearchManager();
    breadcrumbsManager = new BreadcrumbsManager();
    contextMenuManager = new ContextMenuManager();
    keyboardShortcutsManager = new KeyboardShortcutsManager();
    
    // Mobile gestures (only on mobile)
    if (window.innerWidth <= 768) {
        mobileTouchManager = new MobileTouchManager();
    }
    
    // Enhance existing switchPage to update breadcrumbs
    const originalSwitchPage = window.switchPage;
    window.switchPage = function(pageName) {
        originalSwitchPage(pageName);
        if (breadcrumbsManager) {
            breadcrumbsManager.update(pageName);
        }
    };
    
    console.log('✅ Phase 2 Enhancements loaded successfully!');
}

// Auto-init

// ===== PHASE 3 ENHANCEMENTS =====
// ===== PWA MANAGER =====
class PWAManager {
    constructor() {
        this.deferredPrompt = null;
        this.isInstalled = false;
        
        this.init();
    }
    
    init() {
        // Check if already installed
        if (window.matchMedia('(display-mode: standalone)').matches) {
            this.isInstalled = true;
            console.log('✅ PWA: Already installed');
            return;
        }
        
        // Register service worker
        this.registerServiceWorker();
        
        // Listen for install prompt
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            this.deferredPrompt = e;
            this.showInstallBanner();
        });
        
        // Listen for app installed
        window.addEventListener('appinstalled', () => {
            console.log('✅ PWA: Installed successfully');
            this.isInstalled = true;
            this.hideInstallBanner();
        });
        
        console.log('✅ PWA Manager initialized');
    }
    
    async registerServiceWorker() {
        if ('serviceWorker' in navigator) {
            try {
                const registration = await navigator.serviceWorker.register('/service-worker.js');
                console.log('✅ Service Worker registered:', registration.scope);
                
                // Listen for updates
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            this.showUpdateBanner();
                        }
                    });
                });
            } catch (error) {
                console.error('❌ Service Worker registration failed:', error);
            }
        }
    }
    
    showInstallBanner() {
        const banner = document.createElement('div');
        banner.className = 'pwa-install-banner active';
        banner.id = 'pwa-install-banner';
        banner.innerHTML = `
            <div class="pwa-install-content">
                <div class="pwa-install-title">📱 Installer l'application</div>
                <div class="pwa-install-desc">Accès rapide depuis votre écran d'accueil</div>
            </div>
            <button class="pwa-install-btn" onclick="pwaManager.install()">
                <i class="fas fa-download"></i> Installer
            </button>
            <button class="pwa-install-close" onclick="pwaManager.dismissBanner()">
                <i class="fas fa-times"></i>
            </button>
        `;
        
        document.body.appendChild(banner);
        
        // Auto-dismiss after 10 seconds if not clicked
        setTimeout(() => {
            if (document.getElementById('pwa-install-banner')) {
                this.dismissBanner();
            }
        }, 10000);
    }
    
    showUpdateBanner() {
        const banner = document.createElement('div');
        banner.className = 'pwa-update-banner active';
        banner.id = 'pwa-update-banner';
        banner.innerHTML = `
            <strong>✨ Nouvelle version disponible!</strong><br>
            <button onclick="location.reload()" style="margin-top: 0.5rem; background: white; color: #10b981; border: none; padding: 0.5rem 1rem; border-radius: 6px; font-weight: 600; cursor: pointer;">
                Mettre à jour
            </button>
        `;
        
        document.body.appendChild(banner);
    }
    
    async install() {
        if (!this.deferredPrompt) return;
        
        this.deferredPrompt.prompt();
        const { outcome } = await this.deferredPrompt.userChoice;
        
        console.log(`PWA install outcome: ${outcome}`);
        
        this.deferredPrompt = null;
        this.dismissBanner();
    }
    
    dismissBanner() {
        const banner = document.getElementById('pwa-install-banner');
        if (banner) {
            banner.remove();
        }
    }
}

// ===== CUSTOMIZABLE DASHBOARD MANAGER =====
class CustomDashboardManager {
    constructor() {
        this.grid = null;
        this.isCustomizing = false;
        this.widgets = [];
        
        this.init();
    }
    
    init() {
        this.createCustomizeToggle();
        this.createWidgetLibrary();
        this.loadSavedLayout();
        
        console.log('✅ Custom Dashboard Manager initialized');
    }
    
    createCustomizeToggle() {
        const toggle = document.createElement('div');
        toggle.className = 'dashboard-customize-toggle';
        toggle.id = 'customize-toggle';
        toggle.innerHTML = '<i class="fas fa-sliders-h"></i>';
        toggle.title = 'Personnaliser le dashboard';
        toggle.addEventListener('click', () => this.toggleCustomize());
        
        document.body.appendChild(toggle);
    }
    
    createWidgetLibrary() {
        const library = document.createElement('div');
        library.className = 'widget-library';
        library.id = 'widget-library';
        library.innerHTML = `
            <div class="widget-library-title">📦 Widgets disponibles</div>
            
            <div class="widget-template" data-widget="cpu" draggable="true">
                <div class="widget-template-icon">🔧</div>
                <div class="widget-template-name">CPU Monitor</div>
                <div class="widget-template-desc">Utilisation CPU en temps réel</div>
            </div>
            
            <div class="widget-template" data-widget="ram" draggable="true">
                <div class="widget-template-icon">💾</div>
                <div class="widget-template-name">RAM Monitor</div>
                <div class="widget-template-desc">Mémoire système</div>
            </div>
            
            <div class="widget-template" data-widget="disk" draggable="true">
                <div class="widget-template-icon">💿</div>
                <div class="widget-template-name">Disk Usage</div>
                <div class="widget-template-desc">Espace disque</div>
            </div>
            
            <div class="widget-template" data-widget="logs" draggable="true">
                <div class="widget-template-icon">📋</div>
                <div class="widget-template-name">Recent Logs</div>
                <div class="widget-template-desc">Dernières activités</div>
            </div>
            
            <div class="widget-template" data-widget="quick-actions" draggable="true">
                <div class="widget-template-icon">⚡</div>
                <div class="widget-template-name">Quick Actions</div>
                <div class="widget-template-desc">Raccourcis rapides</div>
            </div>
            
            <div class="widget-template" data-widget="server-status" draggable="true">
                <div class="widget-template-icon">🖥️</div>
                <div class="widget-template-name">Server Status</div>
                <div class="widget-template-desc">État des serveurs</div>
            </div>
        `;
        
        document.body.appendChild(library);
        
        // Add drag handlers
        library.querySelectorAll('.widget-template').forEach(template => {
            template.addEventListener('click', () => {
                const widgetType = template.dataset.widget;
                this.addWidget(widgetType);
            });
        });
    }
    
    toggleCustomize() {
        this.isCustomizing = !this.isCustomizing;
        
        const toggle = document.getElementById('customize-toggle');
        const library = document.getElementById('widget-library');
        const quickStats = document.querySelector('.quick-stats-section');
        const pages = document.querySelectorAll('.page-content');
        const customDashboard = document.getElementById('custom-dashboard');
        
        if (this.isCustomizing) {
            toggle.classList.add('active');
            library.classList.add('active');
            
            // Hide regular content
            if (quickStats) quickStats.style.display = 'none';
            pages.forEach(page => page.style.display = 'none');
            
            // Show custom dashboard
            if (!customDashboard) {
                this.createCustomDashboard();
            } else {
                customDashboard.classList.add('active');
            }
            
            // Initialize GridStack
            if (!this.grid) {
                this.initializeGrid();
            }
        } else {
            toggle.classList.remove('active');
            library.classList.remove('active');
            
            // Show regular content
            if (quickStats) quickStats.style.display = 'block';
            
            // Hide custom dashboard
            if (customDashboard) {
                customDashboard.classList.remove('active');
            }
            
            // Save layout
            this.saveLayout();
        }
    }
    
    createCustomDashboard() {
        const container = document.querySelector('.content-wrapper');
        const dashboard = document.createElement('div');
        dashboard.id = 'custom-dashboard';
        dashboard.className = 'customizable-dashboard active';
        dashboard.innerHTML = '<div class="grid-stack"></div>';
        
        container.insertBefore(dashboard, container.firstChild);
    }
    
    initializeGrid() {
        this.grid = GridStack.init({
            cellHeight: 100,
            margin: 10,
            float: true,
            animate: true,
            draggable: {
                handle: '.widget-header'
            }
        }, '.grid-stack');
        
        // Load saved widgets
        const savedWidgets = this.getSavedWidgets();
        savedWidgets.forEach(widget => {
            this.addWidget(widget.type, widget);
        });
    }
    
    addWidget(type, options = {}) {
        const widgetId = `widget-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
        const widgetContent = this.getWidgetContent(type);
        
        const widgetHTML = `
            <div class="widget">
                <div class="widget-header">
                    <div class="widget-title">
                        ${widgetContent.icon} ${widgetContent.title}
                    </div>
                    <div class="widget-actions">
                        <button class="widget-action-btn" onclick="customDashboardManager.removeWidget('${widgetId}')">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </div>
                <div class="widget-body">
                    ${widgetContent.body}
                </div>
            </div>
        `;
        
        this.grid.addWidget({
            id: widgetId,
            w: options.w || 3,
            h: options.h || 2,
            x: options.x,
            y: options.y,
            content: widgetHTML
        });
        
        this.widgets.push({ id: widgetId, type });
    }
    
    removeWidget(widgetId) {
        this.grid.removeWidget(`#${widgetId}`);
        this.widgets = this.widgets.filter(w => w.id !== widgetId);
        this.saveLayout();
    }
    
    getWidgetContent(type) {
        const widgets = {
            'cpu': {
                icon: '🔧',
                title: 'CPU Monitor',
                body: '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; font-weight: 800; color: #667eea;">45%</div><div style="color: #64748b;">CPU Usage</div></div>'
            },
            'ram': {
                icon: '💾',
                title: 'RAM Monitor',
                body: '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; font-weight: 800; color: #10b981;">68%</div><div style="color: #64748b;">Memory Usage</div></div>'
            },
            'disk': {
                icon: '💿',
                title: 'Disk Usage',
                body: '<div style="text-align: center; padding: 2rem;"><div style="font-size: 3rem; font-weight: 800; color: #f59e0b;">72%</div><div style="color: #64748b;">Disk Space</div></div>'
            },
            'logs': {
                icon: '📋',
                title: 'Recent Logs',
                body: '<div style="font-size: 0.85rem; color: #64748b;"><div style="margin-bottom: 0.5rem;">✅ Server restart successful</div><div style="margin-bottom: 0.5rem;">📝 Configuration updated</div><div style="margin-bottom: 0.5rem;">⚠️ High memory usage detected</div></div>'
            },
            'quick-actions': {
                icon: '⚡',
                title: 'Quick Actions',
                body: '<div style="display: grid; gap: 0.5rem;"><button style="padding: 0.75rem; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">Restart Server</button><button style="padding: 0.75rem; background: #10b981; color: white; border: none; border-radius: 8px; cursor: pointer;">Deploy</button></div>'
            },
            'server-status': {
                icon: '🖥️',
                title: 'Server Status',
                body: '<div style="font-size: 0.9rem;"><div style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;"><span style="width: 10px; height: 10px; background: #10b981; border-radius: 50%;"></span><span>Server 1: Online</span></div><div style="margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.5rem;"><span style="width: 10px; height: 10px; background: #10b981; border-radius: 50%;"></span><span>Server 2: Online</span></div></div>'
            }
        };
        
        return widgets[type] || widgets['cpu'];
    }
    
    saveLayout() {
        const layout = [];
        this.grid.engine.nodes.forEach(node => {
            const widget = this.widgets.find(w => w.id === node.el.id);
            if (widget) {
                layout.push({
                    id: widget.id,
                    type: widget.type,
                    x: node.x,
                    y: node.y,
                    w: node.w,
                    h: node.h
                });
            }
        });
        
        localStorage.setItem('dashboard-layout', JSON.stringify(layout));
        console.log('✅ Dashboard layout saved');
    }
    
    loadSavedLayout() {
        // Will be called when grid is initialized
    }
    
    getSavedWidgets() {
        const saved = localStorage.getItem('dashboard-layout');
        return saved ? JSON.parse(saved) : [];
    }
}

// ===== ANALYTICS MANAGER =====
class AnalyticsManager {
    constructor() {
        this.sessionId = this.generateSessionId();
        this.pageViews = 0;
        this.events = [];
        this.startTime = Date.now();
        
        this.init();
    }
    
    init() {
        this.trackPageView();
        this.setupEventListeners();
        this.createAnalyticsBadge();
        
        // Send analytics every 30 seconds
        setInterval(() => this.sendAnalytics(), 30000);
        
        console.log('✅ Analytics Manager initialized');
    }
    
    generateSessionId() {
        return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;
    }
    
    trackPageView() {
        this.pageViews++;
        this.trackEvent('page_view', { page: window.location.pathname });
    }
    
    trackEvent(eventName, data = {}) {
        this.events.push({
            name: eventName,
            data,
            timestamp: Date.now(),
            sessionId: this.sessionId
        });
        
        // Limit events array size
        if (this.events.length > 100) {
            this.events = this.events.slice(-50);
        }
    }
    
    setupEventListeners() {
        // Track navigation
        const originalSwitchPage = window.switchPage;
        window.switchPage = function(pageName) {
            originalSwitchPage(pageName);
            analyticsManager.trackEvent('page_switch', { page: pageName });
        };
        
        // Track search
        document.addEventListener('keydown', (e) => {
            if ((e.ctrlKey || e.metaKey) && e.key === 'k') {
                analyticsManager.trackEvent('shortcut_used', { shortcut: 'ctrl+k', action: 'search' });
            }
            if ((e.ctrlKey || e.metaKey) && e.key === 'd') {
                analyticsManager.trackEvent('shortcut_used', { shortcut: 'ctrl+d', action: 'dark_mode' });
            }
        });
        
        // Track clicks
        document.addEventListener('click', (e) => {
            if (e.target.closest('.nav-item')) {
                analyticsManager.trackEvent('nav_click', { page: e.target.closest('.nav-item').dataset.page });
            }
        });
    }
    
    createAnalyticsBadge() {
        const badge = document.createElement('div');
        badge.className = 'analytics-badge';
        badge.id = 'analytics-badge';
        badge.innerHTML = `
            <span class="analytics-badge-label">Session:</span>
            <span class="analytics-badge-value" id="analytics-session-time">0:00</span>
        `;
        
        document.body.appendChild(badge);
        
        // Update session time every second
        setInterval(() => {
            const elapsed = Math.floor((Date.now() - this.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeEl = document.getElementById('analytics-session-time');
            if (timeEl) {
                timeEl.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
            }
        }, 1000);
        
        // Show badge after 5 seconds
        setTimeout(() => {
            badge.classList.add('active');
        }, 5000);
    }
    
    sendAnalytics() {
        // TODO: Send to analytics endpoint
        console.log('📊 Analytics:', {
            sessionId: this.sessionId,
            pageViews: this.pageViews,
            events: this.events.length,
            duration: Math.floor((Date.now() - this.startTime) / 1000)
        });
    }
    
    getStats() {
        return {
            sessionId: this.sessionId,
            pageViews: this.pageViews,
            events: this.events,
            duration: Date.now() - this.startTime
        };
    }
}

// ===== INITIALIZE PHASE 3 ENHANCEMENTS =====
let pwaManager;
let customDashboardManager;
let analyticsManager;

function initializePhase3Enhancements() {
    console.log('🚀 Initializing Phase 3 Enhancements...');
    
    // Initialize managers
    pwaManager = new PWAManager();
    customDashboardManager = new CustomDashboardManager();
    analyticsManager = new AnalyticsManager();
    
    console.log('✅ Phase 3 Enhancements loaded successfully!');
}

</script>
</body>
</html>
